typeof navigator==="object"&&function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define("Plyr",factory):global.Plyr=factory()}(this,function(){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var getConstructor=function getConstructor(input){return input!==null&&typeof input!=="undefined"?input.constructor:null};var instanceOf=function instanceOf(input,constructor){return Boolean(input&&constructor&&input instanceof constructor)};var isNullOrUndefined=function isNullOrUndefined(input){return input===null||typeof input==="undefined"};var isObject=function isObject(input){return getConstructor(input)===Object};var isNumber=function isNumber(input){return getConstructor(input)===Number&&!Number.isNaN(input)};var isString=function isString(input){return getConstructor(input)===String};var isBoolean=function isBoolean(input){return getConstructor(input)===Boolean};var isFunction=function isFunction(input){return getConstructor(input)===Function};var isArray=function isArray(input){return Array.isArray(input)};var isWeakMap=function isWeakMap(input){return instanceOf(input,WeakMap)};var isNodeList=function isNodeList(input){return instanceOf(input,NodeList)};var isElement=function isElement(input){return instanceOf(input,Element)};var isTextNode=function isTextNode(input){return getConstructor(input)===Text};var isEvent=function isEvent(input){return instanceOf(input,Event)};var isKeyboardEvent=function isKeyboardEvent(input){return instanceOf(input,KeyboardEvent)};var isCue=function isCue(input){return instanceOf(input,window.TextTrackCue)||instanceOf(input,window.VTTCue)};var isTrack=function isTrack(input){return instanceOf(input,TextTrack)||!isNullOrUndefined(input)&&isString(input.kind)};var isEmpty=function isEmpty(input){return isNullOrUndefined(input)||(isString(input)||isArray(input)||isNodeList(input))&&!input.length||isObject(input)&&!Object.keys(input).length};var isUrl=function isUrl(input){if(instanceOf(input,window.URL)){return true}if(!isString(input)){return false}var string=input;if(!input.startsWith("http://")||!input.startsWith("https://")){string="http://".concat(input)}try{return!isEmpty(new URL(string).hostname)}catch(e){return false}};var is={nullOrUndefined:isNullOrUndefined,object:isObject,number:isNumber,string:isString,boolean:isBoolean,function:isFunction,array:isArray,weakMap:isWeakMap,nodeList:isNodeList,element:isElement,textNode:isTextNode,event:isEvent,keyboardEvent:isKeyboardEvent,cue:isCue,track:isTrack,url:isUrl,empty:isEmpty};var supportsPassiveListeners=function(){var supported=false;try{var options=Object.defineProperty({},"passive",{get:function get(){supported=true;return null}});window.addEventListener("test",null,options);window.removeEventListener("test",null,options)}catch(e){}return supported}();function toggleListener(element,event,callback){var _this=this;var toggle=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var passive=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var capture=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(!element||!("addEventListener"in element)||is.empty(event)||!is.function(callback)){return}var events=event.split(" ");var options=capture;if(supportsPassiveListeners){options={passive:passive,capture:capture}}events.forEach(function(type){if(_this&&_this.eventListeners&&toggle){_this.eventListeners.push({element:element,type:type,callback:callback,options:options})}element[toggle?"addEventListener":"removeEventListener"](type,callback,options)})}function on(element){var events=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var callback=arguments.length>2?arguments[2]:undefined;var passive=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var capture=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;toggleListener.call(this,element,events,callback,true,passive,capture)}function off(element){var events=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var callback=arguments.length>2?arguments[2]:undefined;var passive=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var capture=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;toggleListener.call(this,element,events,callback,false,passive,capture)}function once(element){var events=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var callback=arguments.length>2?arguments[2]:undefined;var passive=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var capture=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;function onceCallback(){off(element,events,onceCallback,passive,capture);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}callback.apply(this,args)}toggleListener.call(this,element,events,onceCallback,true,passive,capture)}function triggerEvent(element){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var bubbles=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var detail=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!is.element(element)||is.empty(type)){return}var event=new CustomEvent(type,{bubbles:bubbles,detail:Object.assign({},detail,{plyr:this})});element.dispatchEvent(event)}function unbindListeners(){if(this&&this.eventListeners){this.eventListeners.forEach(function(item){var element=item.element,type=item.type,callback=item.callback,options=item.options;element.removeEventListener(type,callback,options)});this.eventListeners=[]}}function ready(){var _this2=this;return new Promise(function(resolve){return _this2.ready?setTimeout(resolve,0):on.call(_this2,_this2.elements.container,"ready",resolve)}).then(function(){})}function wrap(elements,wrapper){var targets=elements.length?elements:[elements];Array.from(targets).reverse().forEach(function(element,index){var child=index>0?wrapper.cloneNode(true):wrapper;var parent=element.parentNode;var sibling=element.nextSibling;child.appendChild(element);if(sibling){parent.insertBefore(child,sibling)}else{parent.appendChild(child)}})}function setAttributes(element,attributes){if(!is.element(element)||is.empty(attributes)){return}Object.entries(attributes).filter(function(_ref){var _ref2=_slicedToArray(_ref,2),value=_ref2[1];return!is.nullOrUndefined(value)}).forEach(function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],value=_ref4[1];return element.setAttribute(key,value)})}function createElement(type,attributes,text){var element=document.createElement(type);if(is.object(attributes)){setAttributes(element,attributes)}if(is.string(text)){element.innerText=text}return element}function insertAfter(element,target){if(!is.element(element)||!is.element(target)){return}target.parentNode.insertBefore(element,target.nextSibling)}function insertElement(type,parent,attributes,text){if(!is.element(parent)){return}parent.appendChild(createElement(type,attributes,text))}function removeElement(element){if(is.nodeList(element)||is.array(element)){Array.from(element).forEach(removeElement);return}if(!is.element(element)||!is.element(element.parentNode)){return}element.parentNode.removeChild(element)}function emptyElement(element){if(!is.element(element)){return}var length=element.childNodes.length;while(length>0){element.removeChild(element.lastChild);length-=1}}function replaceElement(newChild,oldChild){if(!is.element(oldChild)||!is.element(oldChild.parentNode)||!is.element(newChild)){return null}oldChild.parentNode.replaceChild(newChild,oldChild);return newChild}function getAttributesFromSelector(sel,existingAttributes){if(!is.string(sel)||is.empty(sel)){return{}}var attributes={};var existing=existingAttributes;sel.split(",").forEach(function(s){var selector=s.trim();var className=selector.replace(".","");var stripped=selector.replace(/[[\]]/g,"");var parts=stripped.split("=");var key=parts[0];var value=parts.length>1?parts[1].replace(/["']/g,""):"";var start=selector.charAt(0);switch(start){case".":if(is.object(existing)&&is.string(existing.class)){existing.class+=" ".concat(className)}attributes.class=className;break;case"#":attributes.id=selector.replace("#","");break;case"[":attributes[key]=value;break;default:break}});return attributes}function toggleHidden(element,hidden){if(!is.element(element)){return}var hide=hidden;if(!is.boolean(hide)){hide=!element.hidden}if(hide){element.setAttribute("hidden","")}else{element.removeAttribute("hidden")}}function toggleClass(element,className,force){if(is.nodeList(element)){return Array.from(element).map(function(e){return toggleClass(e,className,force)})}if(is.element(element)){var method="toggle";if(typeof force!=="undefined"){method=force?"add":"remove"}element.classList[method](className);return element.classList.contains(className)}return false}function hasClass(element,className){return is.element(element)&&element.classList.contains(className)}function matches(element,selector){function match(){return Array.from(document.querySelectorAll(selector)).includes(this)}var matches=match;return matches.call(element,selector)}function getElements(selector){return this.elements.container.querySelectorAll(selector)}function getElement(selector){return this.elements.container.querySelector(selector)}function trapFocus(){var element=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var toggle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!is.element(element)){return}var focusable=getElements.call(this,"button:not(:disabled), input:not(:disabled), [tabindex]");var first=focusable[0];var last=focusable[focusable.length-1];var trap=function trap(event){if(event.key!=="Tab"||event.keyCode!==9){return}var focused=document.activeElement;if(focused===last&&!event.shiftKey){first.focus();event.preventDefault()}else if(focused===first&&event.shiftKey){last.focus();event.preventDefault()}};toggleListener.call(this,this.elements.container,"keydown",trap,toggle,false)}function setFocus(){var element=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var tabFocus=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!is.element(element)){return}element.focus({preventScroll:true});if(tabFocus){toggleClass(element,this.config.classNames.tabFocus)}}var transitionEndEvent=function(){var element=document.createElement("span");var events={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};var type=Object.keys(events).find(function(event){return element.style[event]!==undefined});return is.string(type)?events[type]:false}();function repaint(element){setTimeout(function(){try{toggleHidden(element,true);element.offsetHeight;toggleHidden(element,false)}catch(e){}},0)}var browser={isIE:!!document.documentMode,isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform)};var defaultCodecs={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"};var support={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check:function check(type,provider,playsinline){var canPlayInline=browser.isIPhone&&playsinline&&support.playsinline;var api=support[type]||provider!=="html5";var ui=api&&support.rangeInput&&(type!=="video"||!browser.isIPhone||canPlayInline);return{api:api,ui:ui}},pip:function(){if(browser.isIPhone){return false}if(is.function(createElement("video").webkitSetPresentationMode)){return true}if(document.pictureInPictureEnabled&&!createElement("video").disablePictureInPicture){return true}return false}(),airplay:is.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime:function mime(inputType){var _inputType$split=inputType.split("/"),_inputType$split2=_slicedToArray(_inputType$split,1),mediaType=_inputType$split2[0];var type=inputType;if(!this.isHTML5||mediaType!==this.type){return false}if(Object.keys(defaultCodecs).includes(type)){type+='; codecs="'.concat(defaultCodecs[inputType],'"')}try{return Boolean(type&&this.media.canPlayType(type).replace(/no/,""))}catch(e){return false}},textTracks:"textTracks"in document.createElement("video"),rangeInput:function(){var range=document.createElement("input");range.type="range";return range.type==="range"}(),touch:"ontouchstart"in document.documentElement,transitions:transitionEndEvent!==false,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches};var html5={getSources:function getSources(){var _this=this;if(!this.isHTML5){return[]}var sources=Array.from(this.media.querySelectorAll("source"));return sources.filter(function(source){return support.mime.call(_this,source.getAttribute("type"))})},getQualityOptions:function getQualityOptions(){return html5.getSources.call(this).map(function(source){return Number(source.getAttribute("size"))}).filter(Boolean)},extend:function extend(){if(!this.isHTML5){return}var player=this;Object.defineProperty(player.media,"quality",{get:function get(){var sources=html5.getSources.call(player);var source=sources.find(function(source){return source.getAttribute("src")===player.source});return source&&Number(source.getAttribute("size"))},set:function set(input){var sources=html5.getSources.call(player);var source=sources.find(function(source){return Number(source.getAttribute("size"))===input});if(!source){return}var _player$media=player.media,currentTime=_player$media.currentTime,paused=_player$media.paused,preload=_player$media.preload,readyState=_player$media.readyState;player.media.src=source.getAttribute("src");if(preload!=="none"||readyState){player.once("loadedmetadata",function(){player.currentTime=currentTime;if(!paused){player.play()}});player.media.load()}triggerEvent.call(player,player.media,"qualitychange",false,{quality:input})}})},cancelRequests:function cancelRequests(){if(!this.isHTML5){return}removeElement(html5.getSources.call(this));this.media.setAttribute("src",this.config.blankVideo);this.media.load();this.debug.log("Cancelled network requests")}};function dedupe(array){if(!is.array(array)){return array}return array.filter(function(item,index){return array.indexOf(item)===index})}function closest(array,value){if(!is.array(array)||!array.length){return null}return array.reduce(function(prev,curr){return Math.abs(curr-value)<Math.abs(prev-value)?curr:prev})}function cloneDeep(object){return JSON.parse(JSON.stringify(object))}function getDeep(object,path){return path.split(".").reduce(function(obj,key){return obj&&obj[key]},object)}function extend(){var target=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){sources[_key-1]=arguments[_key]}if(!sources.length){return target}var source=sources.shift();if(!is.object(source)){return target}Object.keys(source).forEach(function(key){if(is.object(source[key])){if(!Object.keys(target).includes(key)){Object.assign(target,_defineProperty({},key,{}))}extend(target[key],source[key])}else{Object.assign(target,_defineProperty({},key,source[key]))}});return extend.apply(void 0,[target].concat(sources))}function generateId(prefix){return"".concat(prefix,"-").concat(Math.floor(Math.random()*1e4))}function format(input){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(is.empty(input)){return input}return input.toString().replace(/{(\d+)}/g,function(match,i){return args[i].toString()})}function getPercentage(current,max){if(current===0||max===0||Number.isNaN(current)||Number.isNaN(max)){return 0}return(current/max*100).toFixed(2)}function replaceAll(){var input=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var find=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var replace=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";return input.replace(new RegExp(find.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),replace.toString())}function toTitleCase(){var input=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return input.toString().replace(/\w\S*/g,function(text){return text.charAt(0).toUpperCase()+text.substr(1).toLowerCase()})}function toPascalCase(){var input=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var string=input.toString();string=replaceAll(string,"-"," ");string=replaceAll(string,"_"," ");string=toTitleCase(string);return replaceAll(string," ","")}function toCamelCase(){var input=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var string=input.toString();string=toPascalCase(string);return string.charAt(0).toLowerCase()+string.slice(1)}function stripHTML(source){var fragment=document.createDocumentFragment();var element=document.createElement("div");fragment.appendChild(element);element.innerHTML=source;return fragment.firstChild.innerText}function getHTML(element){var wrapper=document.createElement("div");wrapper.appendChild(element);return wrapper.innerHTML}var resources={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"};var i18n={get:function get(){var key=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(is.empty(key)||is.empty(config)){return""}var string=getDeep(config.i18n,key);if(is.empty(string)){if(Object.keys(resources).includes(key)){return resources[key]}return""}var replace={"{seektime}":config.seekTime,"{title}":config.title};Object.entries(replace).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];string=replaceAll(string,key,value)});return string}};var Storage=function(){function Storage(player){_classCallCheck(this,Storage);this.enabled=player.config.storage.enabled;this.key=player.config.storage.key}_createClass(Storage,[{key:"get",value:function get(key){if(!Storage.supported||!this.enabled){return null}var store=window.localStorage.getItem(this.key);if(is.empty(store)){return null}var json=JSON.parse(store);return is.string(key)&&key.length?json[key]:json}},{key:"set",value:function set(object){if(!Storage.supported||!this.enabled){return}if(!is.object(object)){return}var storage=this.get();if(is.empty(storage)){storage={}}extend(storage,object);window.localStorage.setItem(this.key,JSON.stringify(storage))}}],[{key:"supported",get:function get(){try{if(!("localStorage"in window)){return false}var test="___test";window.localStorage.setItem(test,test);window.localStorage.removeItem(test);return true}catch(e){return false}}}]);return Storage}();function fetch(url){var responseType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"text";return new Promise(function(resolve,reject){try{var request=new XMLHttpRequest;if(!("withCredentials"in request)){return}request.addEventListener("load",function(){if(responseType==="text"){try{resolve(JSON.parse(request.responseText))}catch(e){resolve(request.responseText)}}else{resolve(request.response)}});request.addEventListener("error",function(){throw new Error(request.status)});request.open("GET",url,true);request.responseType=responseType;request.send()}catch(e){reject(e)}})}function loadSprite(url,id){if(!is.string(url)){return}var prefix="cache";var hasId=is.string(id);var isCached=false;var exists=function exists(){return document.getElementById(id)!==null};var update=function update(container,data){container.innerHTML=data;if(hasId&&exists()){return}document.body.insertAdjacentElement("afterbegin",container)};if(!hasId||!exists()){var useStorage=Storage.supported;var container=document.createElement("div");container.setAttribute("hidden","");if(hasId){container.setAttribute("id",id)}if(useStorage){var cached=window.localStorage.getItem("".concat(prefix,"-").concat(id));isCached=cached!==null;if(isCached){var data=JSON.parse(cached);update(container,data.content)}}fetch(url).then(function(result){if(is.empty(result)){return}if(useStorage){window.localStorage.setItem("".concat(prefix,"-").concat(id),JSON.stringify({content:result}))}update(container,result)}).catch(function(){})}}var getHours=function getHours(value){return parseInt(value/60/60%60,10)};var getMinutes=function getMinutes(value){return parseInt(value/60%60,10)};var getSeconds=function getSeconds(value){return parseInt(value%60,10)};function formatTime(){var time=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var displayHours=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var inverted=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!is.number(time)){return formatTime(null,displayHours,inverted)}var format=function format(value){return"0".concat(value).slice(-2)};var hours=getHours(time);var mins=getMinutes(time);var secs=getSeconds(time);if(displayHours||hours>0){hours="".concat(hours,":")}else{hours=""}return"".concat(inverted&&time>0?"-":"").concat(hours).concat(format(mins),":").concat(format(secs))}var controls={getIconUrl:function getIconUrl(){var url=new URL(this.config.iconUrl,window.location);var cors=url.host!==window.location.host||browser.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:cors}},findElements:function findElements(){try{this.elements.controls=getElement.call(this,this.config.selectors.controls.wrapper);this.elements.buttons={play:getElements.call(this,this.config.selectors.buttons.play),pause:getElement.call(this,this.config.selectors.buttons.pause),restart:getElement.call(this,this.config.selectors.buttons.restart),rewind:getElement.call(this,this.config.selectors.buttons.rewind),fastForward:getElement.call(this,this.config.selectors.buttons.fastForward),mute:getElement.call(this,this.config.selectors.buttons.mute),pip:getElement.call(this,this.config.selectors.buttons.pip),airplay:getElement.call(this,this.config.selectors.buttons.airplay),settings:getElement.call(this,this.config.selectors.buttons.settings),captions:getElement.call(this,this.config.selectors.buttons.captions),fullscreen:getElement.call(this,this.config.selectors.buttons.fullscreen)};this.elements.progress=getElement.call(this,this.config.selectors.progress);this.elements.inputs={seek:getElement.call(this,this.config.selectors.inputs.seek),volume:getElement.call(this,this.config.selectors.inputs.volume)};this.elements.display={buffer:getElement.call(this,this.config.selectors.display.buffer),currentTime:getElement.call(this,this.config.selectors.display.currentTime),duration:getElement.call(this,this.config.selectors.display.duration)};if(is.element(this.elements.progress)){this.elements.display.seekTooltip=this.elements.progress.querySelector(".".concat(this.config.classNames.tooltip))}return true}catch(error){this.debug.warn("It looks like there is a problem with your custom controls HTML",error);this.toggleNativeControls(true);return false}},createIcon:function createIcon(type,attributes){var namespace="http://www.w3.org/2000/svg";var iconUrl=controls.getIconUrl.call(this);var iconPath="".concat(!iconUrl.cors?iconUrl.url:"","#").concat(this.config.iconPrefix);var icon=document.createElementNS(namespace,"svg");setAttributes(icon,extend(attributes,{role:"presentation",focusable:"false"}));var use=document.createElementNS(namespace,"use");var path="".concat(iconPath,"-").concat(type);if("href"in use){use.setAttributeNS("http://www.w3.org/1999/xlink","href",path)}use.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",path);icon.appendChild(use);return icon},createLabel:function createLabel(key){var attr=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var text=i18n.get(key,this.config);var attributes=Object.assign({},attr,{class:[attr.class,this.config.classNames.hidden].filter(Boolean).join(" ")});return createElement("span",attributes,text)},createBadge:function createBadge(text){if(is.empty(text)){return null}var badge=createElement("span",{class:this.config.classNames.menu.value});badge.appendChild(createElement("span",{class:this.config.classNames.menu.badge},text));return badge},createButton:function createButton(buttonType,attr){var attributes=Object.assign({},attr);var type=toCamelCase(buttonType);var props={element:"button",toggle:false,label:null,icon:null,labelPressed:null,iconPressed:null};["element","icon","label"].forEach(function(key){if(Object.keys(attributes).includes(key)){props[key]=attributes[key];delete attributes[key]}});if(props.element==="button"&&!Object.keys(attributes).includes("type")){attributes.type="button"}if(Object.keys(attributes).includes("class")){if(!attributes.class.includes(this.config.classNames.control)){attributes.class+=" ".concat(this.config.classNames.control)}}else{attributes.class=this.config.classNames.control}switch(buttonType){case"play":props.toggle=true;props.label="play";props.labelPressed="pause";props.icon="play";props.iconPressed="pause";break;case"mute":props.toggle=true;props.label="mute";props.labelPressed="unmute";props.icon="volume";props.iconPressed="muted";break;case"captions":props.toggle=true;props.label="enableCaptions";props.labelPressed="disableCaptions";props.icon="captions-off";props.iconPressed="captions-on";break;case"fullscreen":props.toggle=true;props.label="enterFullscreen";props.labelPressed="exitFullscreen";props.icon="enter-fullscreen";props.iconPressed="exit-fullscreen";break;case"play-large":attributes.class+=" ".concat(this.config.classNames.control,"--overlaid");type="play";props.label="play";props.icon="play";break;default:if(is.empty(props.label)){props.label=type}if(is.empty(props.icon)){props.icon=buttonType}}var button=createElement(props.element);if(props.toggle){button.appendChild(controls.createIcon.call(this,props.iconPressed,{class:"icon--pressed"}));button.appendChild(controls.createIcon.call(this,props.icon,{class:"icon--not-pressed"}));button.appendChild(controls.createLabel.call(this,props.labelPressed,{class:"label--pressed"}));button.appendChild(controls.createLabel.call(this,props.label,{class:"label--not-pressed"}))}else{button.appendChild(controls.createIcon.call(this,props.icon));button.appendChild(controls.createLabel.call(this,props.label))}extend(attributes,getAttributesFromSelector(this.config.selectors.buttons[type],attributes));setAttributes(button,attributes);if(type==="play"){if(!is.array(this.elements.buttons[type])){this.elements.buttons[type]=[]}this.elements.buttons[type].push(button)}else{this.elements.buttons[type]=button}return button},createRange:function createRange(type,attributes){var input=createElement("input",extend(getAttributesFromSelector(this.config.selectors.inputs[type]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":i18n.get(type,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},attributes));this.elements.inputs[type]=input;controls.updateRangeFill.call(this,input);return input},createProgress:function createProgress(type,attributes){var progress=createElement("progress",extend(getAttributesFromSelector(this.config.selectors.display[type]),{min:0,max:100,value:0,role:"presentation","aria-hidden":true},attributes));if(type!=="volume"){progress.appendChild(createElement("span",null,"0"));var suffixKey={played:"played",buffer:"buffered"}[type];var suffix=suffixKey?i18n.get(suffixKey,this.config):"";progress.innerText="% ".concat(suffix.toLowerCase())}this.elements.display[type]=progress;return progress},createTime:function createTime(type){var attributes=getAttributesFromSelector(this.config.selectors.display[type]);var container=createElement("div",extend(attributes,{class:"".concat(this.config.classNames.display.time," ").concat(attributes.class?attributes.class:"").trim(),"aria-label":i18n.get(type,this.config)}),"00:00");this.elements.display[type]=container;return container},bindMenuItemShortcuts:function bindMenuItemShortcuts(menuItem,type){var _this=this;on(menuItem,"keydown keyup",function(event){if(![32,38,39,40].includes(event.which)){return}event.preventDefault();event.stopPropagation();if(event.type==="keydown"){return}var isRadioButton=matches(menuItem,'[role="menuitemradio"]');if(!isRadioButton&&[32,39].includes(event.which)){controls.showMenuPanel.call(_this,type,true)}else{var target;if(event.which!==32){if(event.which===40||isRadioButton&&event.which===39){target=menuItem.nextElementSibling;if(!is.element(target)){target=menuItem.parentNode.firstElementChild}}else{target=menuItem.previousElementSibling;if(!is.element(target)){target=menuItem.parentNode.lastElementChild}}setFocus.call(_this,target,true)}}},false);on(menuItem,"keyup",function(event){if(event.which!==13){return}controls.focusFirstMenuItem.call(_this,null,true)})},createMenuItem:function createMenuItem(_ref){var _this2=this;var value=_ref.value,list=_ref.list,type=_ref.type,title=_ref.title,_ref$badge=_ref.badge,badge=_ref$badge===void 0?null:_ref$badge,_ref$checked=_ref.checked,checked=_ref$checked===void 0?false:_ref$checked;var attributes=getAttributesFromSelector(this.config.selectors.inputs[type]);var menuItem=createElement("button",extend(attributes,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(attributes.class?attributes.class:"").trim(),"aria-checked":checked,value:value}));var flex=createElement("span");flex.innerHTML=title;if(is.element(badge)){flex.appendChild(badge)}menuItem.appendChild(flex);Object.defineProperty(menuItem,"checked",{enumerable:true,get:function get(){return menuItem.getAttribute("aria-checked")==="true"},set:function set(checked){if(checked){Array.from(menuItem.parentNode.children).filter(function(node){return matches(node,'[role="menuitemradio"]')}).forEach(function(node){return node.setAttribute("aria-checked","false")})}menuItem.setAttribute("aria-checked",checked?"true":"false")}});this.listeners.bind(menuItem,"click keyup",function(event){if(is.keyboardEvent(event)&&event.which!==32){return}event.preventDefault();event.stopPropagation();menuItem.checked=true;switch(type){case"language":_this2.currentTrack=Number(value);break;case"quality":_this2.quality=value;break;case"speed":_this2.speed=parseFloat(value);break;default:break}controls.showMenuPanel.call(_this2,"home",is.keyboardEvent(event))},type,false);controls.bindMenuItemShortcuts.call(this,menuItem,type);list.appendChild(menuItem)},formatTime:function formatTime$$1(){var time=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var inverted=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!is.number(time)){return time}var forceHours=getHours(this.duration)>0;return formatTime(time,forceHours,inverted)},updateTimeDisplay:function updateTimeDisplay(){var target=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var time=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var inverted=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!is.element(target)||!is.number(time)){return}target.innerText=controls.formatTime(time,inverted)},updateVolume:function updateVolume(){if(!this.supported.ui){return}if(is.element(this.elements.inputs.volume)){controls.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume)}if(is.element(this.elements.buttons.mute)){this.elements.buttons.mute.pressed=this.muted||this.volume===0}},setRange:function setRange(target){var value=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!is.element(target)){return}target.value=value;controls.updateRangeFill.call(this,target)},updateProgress:function updateProgress(event){var _this3=this;if(!this.supported.ui||!is.event(event)){return}var value=0;var setProgress=function setProgress(target,input){var value=is.number(input)?input:0;var progress=is.element(target)?target:_this3.elements.display.buffer;if(is.element(progress)){progress.value=value;var label=progress.getElementsByTagName("span")[0];if(is.element(label)){label.childNodes[0].nodeValue=value}}};if(event){switch(event.type){case"timeupdate":case"seeking":case"seeked":value=getPercentage(this.currentTime,this.duration);if(event.type==="timeupdate"){controls.setRange.call(this,this.elements.inputs.seek,value)}break;case"playing":case"progress":setProgress(this.elements.display.buffer,this.buffered*100);break;default:break}}},updateRangeFill:function updateRangeFill(target){var range=is.event(target)?target.target:target;if(!is.element(range)||range.getAttribute("type")!=="range"){return}if(matches(range,this.config.selectors.inputs.seek)){range.setAttribute("aria-valuenow",this.currentTime);var currentTime=controls.formatTime(this.currentTime);var duration=controls.formatTime(this.duration);var format$$1=i18n.get("seekLabel",this.config);range.setAttribute("aria-valuetext",format$$1.replace("{currentTime}",currentTime).replace("{duration}",duration))}else if(matches(range,this.config.selectors.inputs.volume)){var percent=range.value*100;range.setAttribute("aria-valuenow",percent);range.setAttribute("aria-valuetext","".concat(percent.toFixed(1),"%"))}else{range.setAttribute("aria-valuenow",range.value)}if(!browser.isWebkit){return}range.style.setProperty("--value","".concat(range.value/range.max*100,"%"))},updateSeekTooltip:function updateSeekTooltip(event){var _this4=this;if(!this.config.tooltips.seek||!is.element(this.elements.inputs.seek)||!is.element(this.elements.display.seekTooltip)||this.duration===0){return}var percent=0;var clientRect=this.elements.progress.getBoundingClientRect();var visible="".concat(this.config.classNames.tooltip,"--visible");var toggle=function toggle(_toggle){toggleClass(_this4.elements.display.seekTooltip,visible,_toggle)};if(this.touch){toggle(false);return}if(is.event(event)){percent=100/clientRect.width*(event.pageX-clientRect.left)}else if(hasClass(this.elements.display.seekTooltip,visible)){percent=parseFloat(this.elements.display.seekTooltip.style.left,10)}else{return}if(percent<0){percent=0}else if(percent>100){percent=100}controls.updateTimeDisplay.call(this,this.elements.display.seekTooltip,this.duration/100*percent);this.elements.display.seekTooltip.style.left="".concat(percent,"%");if(is.event(event)&&["mouseenter","mouseleave"].includes(event.type)){toggle(event.type==="mouseenter")}},timeUpdate:function timeUpdate(event){var invert=!is.element(this.elements.display.duration)&&this.config.invertTime;controls.updateTimeDisplay.call(this,this.elements.display.currentTime,invert?this.duration-this.currentTime:this.currentTime,invert);if(event&&event.type==="timeupdate"&&this.media.seeking){return}controls.updateProgress.call(this,event)},durationUpdate:function durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime){return}if(this.duration>=Math.pow(2,32)){toggleHidden(this.elements.display.currentTime,true);toggleHidden(this.elements.progress,true);return}if(is.element(this.elements.inputs.seek)){this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration)}var hasDuration=is.element(this.elements.display.duration);if(!hasDuration&&this.config.displayDuration&&this.paused){controls.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration)}if(hasDuration){controls.updateTimeDisplay.call(this,this.elements.display.duration,this.duration)}controls.updateSeekTooltip.call(this)},toggleMenuButton:function toggleMenuButton(setting,toggle){toggleHidden(this.elements.settings.buttons[setting],!toggle)},updateSetting:function updateSetting(setting,container,input){var pane=this.elements.settings.panels[setting];var value=null;var list=container;if(setting==="captions"){value=this.currentTrack}else{value=!is.empty(input)?input:this[setting];if(is.empty(value)){value=this.config[setting].default}if(!is.empty(this.options[setting])&&!this.options[setting].includes(value)){this.debug.warn("Unsupported value of '".concat(value,"' for ").concat(setting));return}if(!this.config[setting].options.includes(value)){this.debug.warn("Disabled value of '".concat(value,"' for ").concat(setting));return}}if(!is.element(list)){list=pane&&pane.querySelector('[role="menu"]')}if(!is.element(list)){return}var label=this.elements.settings.buttons[setting].querySelector(".".concat(this.config.classNames.menu.value));label.innerHTML=controls.getLabel.call(this,setting,value);var target=list&&list.querySelector('[value="'.concat(value,'"]'));if(is.element(target)){target.checked=true}},getLabel:function getLabel(setting,value){switch(setting){case"speed":return value===1?i18n.get("normal",this.config):"".concat(value,"&times;");case"quality":if(is.number(value)){var label=i18n.get("qualityLabel.".concat(value),this.config);if(!label.length){return"".concat(value,"p")}return label}return toTitleCase(value);case"captions":return captions.getLabel.call(this);default:return null}},setQualityMenu:function setQualityMenu(options){var _this5=this;if(!is.element(this.elements.settings.panels.quality)){return}var type="quality";var list=this.elements.settings.panels.quality.querySelector('[role="menu"]');if(is.array(options)){this.options.quality=dedupe(options).filter(function(quality){return _this5.config.quality.options.includes(quality)})}var toggle=!is.empty(this.options.quality)&&this.options.quality.length>1;controls.toggleMenuButton.call(this,type,toggle);emptyElement(list);controls.checkMenu.call(this);if(!toggle){return}var getBadge=function getBadge(quality){var label=i18n.get("qualityBadge.".concat(quality),_this5.config);if(!label.length){return null}return controls.createBadge.call(_this5,label)};this.options.quality.sort(function(a,b){var sorting=_this5.config.quality.options;return sorting.indexOf(a)>sorting.indexOf(b)?1:-1}).forEach(function(quality){controls.createMenuItem.call(_this5,{value:quality,list:list,type:type,title:controls.getLabel.call(_this5,"quality",quality),badge:getBadge(quality)})});controls.updateSetting.call(this,type,list)},setCaptionsMenu:function setCaptionsMenu(){var _this6=this;if(!is.element(this.elements.settings.panels.captions)){return}var type="captions";var list=this.elements.settings.panels.captions.querySelector('[role="menu"]');var tracks=captions.getTracks.call(this);var toggle=Boolean(tracks.length);controls.toggleMenuButton.call(this,type,toggle);emptyElement(list);controls.checkMenu.call(this);if(!toggle){return}var options=tracks.map(function(track,value){return{value:value,checked:_this6.captions.toggled&&_this6.currentTrack===value,title:captions.getLabel.call(_this6,track),badge:track.language&&controls.createBadge.call(_this6,track.language.toUpperCase()),list:list,type:"language"}});options.unshift({value:-1,checked:!this.captions.toggled,title:i18n.get("disabled",this.config),list:list,type:"language"});options.forEach(controls.createMenuItem.bind(this));controls.updateSetting.call(this,type,list)},setSpeedMenu:function setSpeedMenu(options){var _this7=this;if(!is.element(this.elements.settings.panels.speed)){return}var type="speed";var list=this.elements.settings.panels.speed.querySelector('[role="menu"]');if(is.array(options)){this.options.speed=options}else if(this.isHTML5||this.isVimeo){this.options.speed=[.5,.75,1,1.25,1.5,1.75,2]}this.options.speed=this.options.speed.filter(function(speed){return _this7.config.speed.options.includes(speed)});var toggle=!is.empty(this.options.speed)&&this.options.speed.length>1;controls.toggleMenuButton.call(this,type,toggle);emptyElement(list);controls.checkMenu.call(this);if(!toggle){return}this.options.speed.forEach(function(speed){controls.createMenuItem.call(_this7,{value:speed,list:list,type:type,title:controls.getLabel.call(_this7,"speed",speed)})});controls.updateSetting.call(this,type,list)},checkMenu:function checkMenu(){var buttons=this.elements.settings.buttons;var visible=!is.empty(buttons)&&Object.values(buttons).some(function(button){return!button.hidden});toggleHidden(this.elements.settings.menu,!visible)},focusFirstMenuItem:function focusFirstMenuItem(pane){var tabFocus=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.elements.settings.popup.hidden){return}var target=pane;if(!is.element(target)){target=Object.values(this.elements.settings.panels).find(function(pane){return!pane.hidden})}var firstItem=target.querySelector('[role^="menuitem"]');setFocus.call(this,firstItem,tabFocus)},toggleMenu:function toggleMenu(input){var popup=this.elements.settings.popup;var button=this.elements.buttons.settings;if(!is.element(popup)||!is.element(button)){return}var hidden=popup.hidden;var show=hidden;if(is.boolean(input)){show=input}else if(is.keyboardEvent(input)&&input.which===27){show=false}else if(is.event(input)){var isMenuItem=popup.contains(input.target);if(isMenuItem||!isMenuItem&&input.target!==button&&show){return}}button.setAttribute("aria-expanded",show);toggleHidden(popup,!show);toggleClass(this.elements.container,this.config.classNames.menu.open,show);if(show&&is.keyboardEvent(input)){controls.focusFirstMenuItem.call(this,null,true)}else if(!show&&!hidden){setFocus.call(this,button,is.keyboardEvent(input))}},getMenuSize:function getMenuSize(tab){var clone=tab.cloneNode(true);clone.style.position="absolute";clone.style.opacity=0;clone.removeAttribute("hidden");tab.parentNode.appendChild(clone);var width=clone.scrollWidth;var height=clone.scrollHeight;removeElement(clone);return{width:width,height:height}},showMenuPanel:function showMenuPanel(){var _this8=this;var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var tabFocus=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var target=document.getElementById("plyr-settings-".concat(this.id,"-").concat(type));if(!is.element(target)){return}var container=target.parentNode;var current=Array.from(container.children).find(function(node){return!node.hidden});if(support.transitions&&!support.reducedMotion){container.style.width="".concat(current.scrollWidth,"px");container.style.height="".concat(current.scrollHeight,"px");var size=controls.getMenuSize.call(this,target);var restore=function restore(event){if(event.target!==container||!["width","height"].includes(event.propertyName)){return}container.style.width="";container.style.height="";off.call(_this8,container,transitionEndEvent,restore)};on.call(this,container,transitionEndEvent,restore);container.style.width="".concat(size.width,"px");container.style.height="".concat(size.height,"px")}toggleHidden(current,true);toggleHidden(target,false);controls.focusFirstMenuItem.call(this,target,tabFocus)},setDownloadLink:function setDownloadLink(){var button=this.elements.buttons.download;if(!is.element(button)){return}button.setAttribute("href",this.download)},create:function create(data){var _this9=this;var container=createElement("div",getAttributesFromSelector(this.config.selectors.controls.wrapper));if(this.config.controls.includes("restart")){container.appendChild(controls.createButton.call(this,"restart"))}if(this.config.controls.includes("rewind")){container.appendChild(controls.createButton.call(this,"rewind"))}if(this.config.controls.includes("play")){container.appendChild(controls.createButton.call(this,"play"))}if(this.config.controls.includes("fast-forward")){container.appendChild(controls.createButton.call(this,"fast-forward"))}if(this.config.controls.includes("current-time")){container.appendChild(controls.createTime.call(this,"currentTime"))}if(this.config.controls.includes("progress")){var progress=createElement("div",getAttributesFromSelector(this.config.selectors.progress));progress.appendChild(controls.createRange.call(this,"seek",{id:"plyr-seek-".concat(data.id)}));progress.appendChild(controls.createProgress.call(this,"buffer"));if(this.config.tooltips.seek){var tooltip=createElement("span",{class:this.config.classNames.tooltip},"00:00");progress.appendChild(tooltip);this.elements.display.seekTooltip=tooltip}this.elements.progress=progress;container.appendChild(this.elements.progress)}if(this.config.controls.includes("duration")){container.appendChild(controls.createTime.call(this,"duration"))}if(this.config.controls.includes("mute")||this.config.controls.includes("volume")){var volume=createElement("div",{class:"plyr__volume"});if(this.config.controls.includes("mute")){volume.appendChild(controls.createButton.call(this,"mute"))}if(this.config.controls.includes("volume")){var attributes={max:1,step:.05,value:this.config.volume};volume.appendChild(controls.createRange.call(this,"volume",extend(attributes,{id:"plyr-volume-".concat(data.id)})));this.elements.volume=volume}container.appendChild(volume)}if(this.config.controls.includes("captions")){container.appendChild(controls.createButton.call(this,"captions"))}if(this.config.controls.includes("settings")&&!is.empty(this.config.settings)){var control=createElement("div",{class:"plyr__menu",hidden:""});control.appendChild(controls.createButton.call(this,"settings",{"aria-haspopup":true,"aria-controls":"plyr-settings-".concat(data.id),"aria-expanded":false}));var popup=createElement("div",{class:"plyr__menu__container",id:"plyr-settings-".concat(data.id),hidden:""});var inner=createElement("div");var home=createElement("div",{id:"plyr-settings-".concat(data.id,"-home")});var menu=createElement("div",{role:"menu"});home.appendChild(menu);inner.appendChild(home);this.elements.settings.panels.home=home;this.config.settings.forEach(function(type){var menuItem=createElement("button",extend(getAttributesFromSelector(_this9.config.selectors.buttons.settings),{type:"button",class:"".concat(_this9.config.classNames.control," ").concat(_this9.config.classNames.control,"--forward"),role:"menuitem","aria-haspopup":true,hidden:""}));controls.bindMenuItemShortcuts.call(_this9,menuItem,type);on(menuItem,"click",function(){controls.showMenuPanel.call(_this9,type,false)});var flex=createElement("span",null,i18n.get(type,_this9.config));var value=createElement("span",{class:_this9.config.classNames.menu.value});value.innerHTML=data[type];flex.appendChild(value);menuItem.appendChild(flex);menu.appendChild(menuItem);var pane=createElement("div",{id:"plyr-settings-".concat(data.id,"-").concat(type),hidden:""});var backButton=createElement("button",{type:"button",class:"".concat(_this9.config.classNames.control," ").concat(_this9.config.classNames.control,"--back")});backButton.appendChild(createElement("span",{"aria-hidden":true},i18n.get(type,_this9.config)));backButton.appendChild(createElement("span",{class:_this9.config.classNames.hidden},i18n.get("menuBack",_this9.config)));on(pane,"keydown",function(event){if(event.which!==37){return}event.preventDefault();event.stopPropagation();controls.showMenuPanel.call(_this9,"home",true)},false);on(backButton,"click",function(){controls.showMenuPanel.call(_this9,"home",false)});pane.appendChild(backButton);pane.appendChild(createElement("div",{role:"menu"}));inner.appendChild(pane);_this9.elements.settings.buttons[type]=menuItem;_this9.elements.settings.panels[type]=pane});popup.appendChild(inner);control.appendChild(popup);container.appendChild(control);this.elements.settings.popup=popup;this.elements.settings.menu=control}if(this.config.controls.includes("pip")&&support.pip){container.appendChild(controls.createButton.call(this,"pip"))}if(this.config.controls.includes("airplay")&&support.airplay){container.appendChild(controls.createButton.call(this,"airplay"))}if(this.config.controls.includes("download")){var _attributes={element:"a",href:this.download,target:"_blank"};var download=this.config.urls.download;if(!is.url(download)&&this.isEmbed){extend(_attributes,{icon:"logo-".concat(this.provider),label:this.provider})}container.appendChild(controls.createButton.call(this,"download",_attributes))}if(this.config.controls.includes("fullscreen")){container.appendChild(controls.createButton.call(this,"fullscreen"))}if(this.config.controls.includes("play-large")){this.elements.container.appendChild(controls.createButton.call(this,"play-large"))}this.elements.controls=container;if(this.isHTML5){controls.setQualityMenu.call(this,html5.getQualityOptions.call(this))}controls.setSpeedMenu.call(this);return container},inject:function inject(){var _this10=this;if(this.config.loadSprite){var icon=controls.getIconUrl.call(this);if(icon.cors){loadSprite(icon.url,"sprite-plyr")}}this.id=Math.floor(Math.random()*1e4);var container=null;this.elements.controls=null;var props={id:this.id,seektime:this.config.seekTime,title:this.config.title};var update=true;if(is.function(this.config.controls)){this.config.controls=this.config.controls.call(this.props)}if(!this.config.controls){this.config.controls=[]}if(is.element(this.config.controls)||is.string(this.config.controls)){container=this.config.controls}else{container=controls.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:captions.getLabel.call(this)});update=false}var replace=function replace(input){var result=input;Object.entries(props).forEach(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1];result=replaceAll(result,"{".concat(key,"}"),value)});return result};if(update){if(is.string(this.config.controls)){container=replace(container)}else if(is.element(container)){container.innerHTML=replace(container.innerHTML)}}var target;if(is.string(this.config.selectors.controls.container)){target=document.querySelector(this.config.selectors.controls.container)}if(!is.element(target)){target=this.elements.container}var insertMethod=is.element(container)?"insertAdjacentElement":"insertAdjacentHTML";target[insertMethod]("afterbegin",container);if(!is.element(this.elements.controls)){controls.findElements.call(this)}if(!is.empty(this.elements.buttons)){var addProperty=function addProperty(button){var className=_this10.config.classNames.controlPressed;Object.defineProperty(button,"pressed",{enumerable:true,get:function get(){return hasClass(button,className)},set:function set(){var pressed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;toggleClass(button,className,pressed)}})};Object.values(this.elements.buttons).filter(Boolean).forEach(function(button){if(is.array(button)||is.nodeList(button)){Array.from(button).filter(Boolean).forEach(addProperty)}else{addProperty(button)}})}if(window.navigator.userAgent.includes("Edge")){repaint(target)}if(this.config.tooltips.controls){var _this$config=this.config,classNames=_this$config.classNames,selectors=_this$config.selectors;var selector="".concat(selectors.controls.wrapper," ").concat(selectors.labels," .").concat(classNames.hidden);var labels=getElements.call(this,selector);Array.from(labels).forEach(function(label){toggleClass(label,_this10.config.classNames.hidden,false);toggleClass(label,_this10.config.classNames.tooltip,true)})}}};function parseUrl(input){var safe=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var url=input;if(safe){var parser=document.createElement("a");parser.href=url;url=parser.href}try{return new URL(url)}catch(e){return null}}function buildUrlParams(input){var params=new URLSearchParams;if(is.object(input)){Object.entries(input).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];params.set(key,value)})}return params}var captions={setup:function setup(){if(!this.supported.ui){return}if(!this.isVideo||this.isYouTube||this.isHTML5&&!support.textTracks){if(is.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")){controls.setCaptionsMenu.call(this)}return}if(!is.element(this.elements.captions)){this.elements.captions=createElement("div",getAttributesFromSelector(this.config.selectors.captions));insertAfter(this.elements.captions,this.elements.wrapper)}if(browser.isIE&&window.URL){var elements=this.media.querySelectorAll("track");Array.from(elements).forEach(function(track){var src=track.getAttribute("src");var url=parseUrl(src);if(url!==null&&url.hostname!==window.location.href.hostname&&["http:","https:"].includes(url.protocol)){fetch(src,"blob").then(function(blob){track.setAttribute("src",window.URL.createObjectURL(blob))}).catch(function(){removeElement(track)})}})}var browserLanguages=navigator.languages||[navigator.language||navigator.userLanguage||"en"];var languages=dedupe(browserLanguages.map(function(language){return language.split("-")[0]}));var language=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();if(language==="auto"){var _languages=_slicedToArray(languages,1);language=_languages[0]}var active=this.storage.get("captions");if(!is.boolean(active)){active=this.config.captions.active}Object.assign(this.captions,{toggled:false,active:active,language:language,languages:languages});if(this.isHTML5){var trackEvents=this.config.captions.update?"addtrack removetrack":"removetrack";on.call(this,this.media.textTracks,trackEvents,captions.update.bind(this))}setTimeout(captions.update.bind(this),0)},update:function update(){var _this=this;var tracks=captions.getTracks.call(this,true);var _this$captions=this.captions,active=_this$captions.active,language=_this$captions.language,meta=_this$captions.meta,currentTrackNode=_this$captions.currentTrackNode;var languageExists=Boolean(tracks.find(function(track){return track.language===language}));if(this.isHTML5&&this.isVideo){tracks.filter(function(track){return!meta.get(track)}).forEach(function(track){_this.debug.log("Track added",track);meta.set(track,{default:track.mode==="showing"});track.mode="hidden";on.call(_this,track,"cuechange",function(){return captions.updateCues.call(_this)})})}if(languageExists&&this.language!==language||!tracks.includes(currentTrackNode)){captions.setLanguage.call(this,language);captions.toggle.call(this,active&&languageExists)}toggleClass(this.elements.container,this.config.classNames.captions.enabled,!is.empty(tracks));if((this.config.controls||[]).includes("settings")&&this.config.settings.includes("captions")){controls.setCaptionsMenu.call(this)}},toggle:function toggle(input){var passive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this.supported.ui){return}var toggled=this.captions.toggled;var activeClass=this.config.classNames.captions.active;var active=is.nullOrUndefined(input)?!toggled:input;if(active!==toggled){if(!passive){this.captions.active=active;this.storage.set({captions:active})}if(!this.language&&active&&!passive){var tracks=captions.getTracks.call(this);var track=captions.findTrack.call(this,[this.captions.language].concat(_toConsumableArray(this.captions.languages)),true);this.captions.language=track.language;captions.set.call(this,tracks.indexOf(track));return}if(this.elements.buttons.captions){this.elements.buttons.captions.pressed=active}toggleClass(this.elements.container,activeClass,active);this.captions.toggled=active;controls.updateSetting.call(this,"captions");triggerEvent.call(this,this.media,active?"captionsenabled":"captionsdisabled")}},set:function set(index){var passive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var tracks=captions.getTracks.call(this);if(index===-1){captions.toggle.call(this,false,passive);return}if(!is.number(index)){this.debug.warn("Invalid caption argument",index);return}if(!(index in tracks)){this.debug.warn("Track not found",index);return}if(this.captions.currentTrack!==index){this.captions.currentTrack=index;var track=tracks[index];var _ref=track||{},language=_ref.language;this.captions.currentTrackNode=track;controls.updateSetting.call(this,"captions");if(!passive){this.captions.language=language;this.storage.set({language:language})}if(this.isVimeo){this.embed.enableTextTrack(language)}triggerEvent.call(this,this.media,"languagechange")}captions.toggle.call(this,true,passive);if(this.isHTML5&&this.isVideo){captions.updateCues.call(this)}},setLanguage:function setLanguage(input){var passive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!is.string(input)){this.debug.warn("Invalid language argument",input);return}var language=input.toLowerCase();this.captions.language=language;var tracks=captions.getTracks.call(this);var track=captions.findTrack.call(this,[language]);captions.set.call(this,tracks.indexOf(track),passive)},getTracks:function getTracks(){var _this2=this;var update=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var tracks=Array.from((this.media||{}).textTracks||[]);return tracks.filter(function(track){return!_this2.isHTML5||update||_this2.captions.meta.has(track)}).filter(function(track){return["captions","subtitles"].includes(track.kind)})},findTrack:function findTrack(languages){var _this3=this;var force=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var tracks=captions.getTracks.call(this);var sortIsDefault=function sortIsDefault(track){return Number((_this3.captions.meta.get(track)||{}).default)};var sorted=Array.from(tracks).sort(function(a,b){return sortIsDefault(b)-sortIsDefault(a)});var track;languages.every(function(language){track=sorted.find(function(track){return track.language===language});return!track});return track||(force?sorted[0]:undefined)},getCurrentTrack:function getCurrentTrack(){return captions.getTracks.call(this)[this.currentTrack]},getLabel:function getLabel(track){var currentTrack=track;if(!is.track(currentTrack)&&support.textTracks&&this.captions.toggled){currentTrack=captions.getCurrentTrack.call(this)}if(is.track(currentTrack)){if(!is.empty(currentTrack.label)){return currentTrack.label}if(!is.empty(currentTrack.language)){return track.language.toUpperCase()}return i18n.get("enabled",this.config)}return i18n.get("disabled",this.config)},updateCues:function updateCues(input){if(!this.supported.ui){return}if(!is.element(this.elements.captions)){this.debug.warn("No captions element to render to");return}if(!is.nullOrUndefined(input)&&!Array.isArray(input)){this.debug.warn("updateCues: Invalid input",input);return}var cues=input;if(!cues){var track=captions.getCurrentTrack.call(this);cues=Array.from((track||{}).activeCues||[]).map(function(cue){return cue.getCueAsHTML()}).map(getHTML)}var content=cues.map(function(cueText){return cueText.trim()}).join("\n");var changed=content!==this.elements.captions.innerHTML;if(changed){emptyElement(this.elements.captions);var caption=createElement("span",getAttributesFromSelector(this.config.selectors.caption));caption.innerHTML=content;this.elements.captions.appendChild(caption);triggerEvent.call(this,this.media,"cuechange")}}};var defaults={enabled:true,title:"",debug:false,autoplay:false,autopause:true,playsinline:true,seekTime:10,volume:1,muted:false,duration:null,displayDuration:true,invertTime:true,toggleInvert:true,ratio:"16:9",clickToPlay:true,hideControls:true,resetOnEnd:false,disableContextMenu:true,loadSprite:true,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.4.7/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240]},loop:{active:false},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2]},keyboard:{focused:true,global:false},tooltips:{controls:false,seek:true},captions:{active:false,language:"auto",update:false},fullscreen:{enabled:true,fallback:true,iosNative:false},storage:{enabled:true,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/v2/video/{0}.json"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://www.googleapis.com/youtube/v3/videos?id={0}&key={1}&fields=items(snippet(title))&part=snippet"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption",menu:{quality:".js-plyr__menu__list--quality"}},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},tabFocus:"plyr__tab-focus"},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id"}},keys:{google:null},ads:{enabled:false,publisherId:""}};var pip={active:"picture-in-picture",inactive:"inline"};var providers={html5:"html5",youtube:"youtube",vimeo:"vimeo"};var types={audio:"audio",video:"video"};function getProviderByUrl(url){if(/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.?be)\/.+$/.test(url)){return providers.youtube}if(/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(url)){return providers.vimeo}return null}var noop=function noop(){};var Console=function(){function Console(){var enabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,Console);this.enabled=window.console&&enabled;if(this.enabled){this.log("Debugging enabled")}}_createClass(Console,[{key:"log",get:function get(){return this.enabled?Function.prototype.bind.call(console.log,console):noop}},{key:"warn",get:function get(){return this.enabled?Function.prototype.bind.call(console.warn,console):noop}},{key:"error",get:function get(){return this.enabled?Function.prototype.bind.call(console.error,console):noop}}]);return Console}();function onChange(){if(!this.enabled){return}var button=this.player.elements.buttons.fullscreen;if(is.element(button)){button.pressed=this.active}triggerEvent.call(this.player,this.target,this.active?"enterfullscreen":"exitfullscreen",true);if(!browser.isIos){trapFocus.call(this.player,this.target,this.active)}}function toggleFallback(){var _this=this;var toggle=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(toggle){this.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}}else{window.scrollTo(this.scrollPosition.x,this.scrollPosition.y)}document.body.style.overflow=toggle?"hidden":"";toggleClass(this.target,this.player.config.classNames.fullscreen.fallback,toggle);if(browser.isIos){var viewport=document.head.querySelector('meta[name="viewport"]');var property="viewport-fit=cover";if(!viewport){viewport=document.createElement("meta");viewport.setAttribute("name","viewport")}var hasProperty=is.string(viewport.content)&&viewport.content.includes(property);if(toggle){this.cleanupViewport=!hasProperty;if(!hasProperty){viewport.content+=",".concat(property)}}else if(this.cleanupViewport){viewport.content=viewport.content.split(",").filter(function(part){return part.trim()!==property}).join(",")}setTimeout(function(){return repaint(_this.target)},100)}onChange.call(this)}var Fullscreen=function(){function Fullscreen(player){var _this2=this;_classCallCheck(this,Fullscreen);this.player=player;this.prefix=Fullscreen.prefix;this.property=Fullscreen.property;this.scrollPosition={x:0,y:0};on.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),function(){onChange.call(_this2)});on.call(this.player,this.player.elements.container,"dblclick",function(event){if(is.element(_this2.player.elements.controls)&&_this2.player.elements.controls.contains(event.target)){return}_this2.toggle()});this.update()}_createClass(Fullscreen,[{key:"update",value:function update(){if(this.enabled){this.player.debug.log("".concat(Fullscreen.native?"Native":"Fallback"," fullscreen enabled"))}else{this.player.debug.log("Fullscreen not supported and fallback disabled")}toggleClass(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.enabled)}},{key:"enter",value:function enter(){if(!this.enabled){return}if(browser.isIos&&this.player.config.fullscreen.iosNative){this.target.webkitEnterFullscreen()}else if(!Fullscreen.native){toggleFallback.call(this,true)}else if(!this.prefix){this.target.requestFullscreen()}else if(!is.empty(this.prefix)){this.target["".concat(this.prefix,"Request").concat(this.property)]()}}},{key:"exit",value:function exit(){if(!this.enabled){return}if(browser.isIos&&this.player.config.fullscreen.iosNative){this.target.webkitExitFullscreen();this.player.play()}else if(!Fullscreen.native){toggleFallback.call(this,false)}else if(!this.prefix){(document.cancelFullScreen||document.exitFullscreen).call(document)}else if(!is.empty(this.prefix)){var action=this.prefix==="moz"?"Cancel":"Exit";document["".concat(this.prefix).concat(action).concat(this.property)]()}}},{key:"toggle",value:function toggle(){if(!this.active){this.enter()}else{this.exit()}}},{key:"enabled",get:function get(){return(Fullscreen.native||this.player.config.fullscreen.fallback)&&this.player.config.fullscreen.enabled&&this.player.supported.ui&&this.player.isVideo}},{key:"active",get:function get(){if(!this.enabled){return false}if(!Fullscreen.native){return hasClass(this.target,this.player.config.classNames.fullscreen.fallback)}var element=!this.prefix?document.fullscreenElement:document["".concat(this.prefix).concat(this.property,"Element")];return element===this.target}},{key:"target",get:function get(){return browser.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.container}}],[{key:"native",get:function get(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function get(){if(is.function(document.exitFullscreen)){return""}var value="";var prefixes=["webkit","moz","ms"];prefixes.some(function(pre){if(is.function(document["".concat(pre,"ExitFullscreen")])||is.function(document["".concat(pre,"CancelFullScreen")])){value=pre;return true}return false});return value}},{key:"property",get:function get(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}}]);return Fullscreen}();function loadImage(src){var minWidth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return new Promise(function(resolve,reject){var image=new Image;var handler=function handler(){delete image.onload;delete image.onerror;(image.naturalWidth>=minWidth?resolve:reject)(image)};Object.assign(image,{onload:handler,onerror:handler,src:src})})}var ui={addStyleHook:function addStyleHook(){toggleClass(this.elements.container,this.config.selectors.container.replace(".",""),true);toggleClass(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls:function toggleNativeControls(){var toggle=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(toggle&&this.isHTML5){this.media.setAttribute("controls","")}else{this.media.removeAttribute("controls")}},build:function build(){var _this=this;this.listeners.media();if(!this.supported.ui){this.debug.warn("Basic support only for ".concat(this.provider," ").concat(this.type));ui.toggleNativeControls.call(this,true);return}if(!is.element(this.elements.controls)){controls.inject.call(this);this.listeners.controls()}ui.toggleNativeControls.call(this);if(this.isHTML5){captions.setup.call(this)}this.volume=null;this.muted=null;this.speed=null;this.loop=null;this.quality=null;controls.updateVolume.call(this);controls.timeUpdate.call(this);ui.checkPlaying.call(this);toggleClass(this.elements.container,this.config.classNames.pip.supported,support.pip&&this.isHTML5&&this.isVideo);toggleClass(this.elements.container,this.config.classNames.airplay.supported,support.airplay&&this.isHTML5);toggleClass(this.elements.container,this.config.classNames.isIos,browser.isIos);toggleClass(this.elements.container,this.config.classNames.isTouch,this.touch);this.ready=true;setTimeout(function(){triggerEvent.call(_this,_this.media,"ready")},0);ui.setTitle.call(this);if(this.poster){ui.setPoster.call(this,this.poster,false).catch(function(){})}if(this.config.duration){controls.durationUpdate.call(this)}},setTitle:function setTitle(){var label=i18n.get("play",this.config);if(is.string(this.config.title)&&!is.empty(this.config.title)){label+=", ".concat(this.config.title)}Array.from(this.elements.buttons.play||[]).forEach(function(button){button.setAttribute("aria-label",label)});if(this.isEmbed){var iframe=getElement.call(this,"iframe");if(!is.element(iframe)){return}var title=!is.empty(this.config.title)?this.config.title:"video";var format=i18n.get("frameTitle",this.config);iframe.setAttribute("title",format.replace("{title}",title))}},togglePoster:function togglePoster(enable){toggleClass(this.elements.container,this.config.classNames.posterEnabled,enable)},setPoster:function setPoster(poster){var _this2=this;var passive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(passive&&this.poster){return Promise.reject(new Error("Poster already set"))}this.media.setAttribute("poster",poster);return ready.call(this).then(function(){return loadImage(poster)}).catch(function(err){if(poster===_this2.poster){ui.togglePoster.call(_this2,false)}throw err}).then(function(){if(poster!==_this2.poster){throw new Error("setPoster cancelled by later call to setPoster")}}).then(function(){Object.assign(_this2.elements.poster.style,{backgroundImage:"url('".concat(poster,"')"),backgroundSize:""});ui.togglePoster.call(_this2,true);return poster})},checkPlaying:function checkPlaying(event){var _this3=this;toggleClass(this.elements.container,this.config.classNames.playing,this.playing);toggleClass(this.elements.container,this.config.classNames.paused,this.paused);toggleClass(this.elements.container,this.config.classNames.stopped,this.stopped);Array.from(this.elements.buttons.play||[]).forEach(function(target){target.pressed=_this3.playing});if(is.event(event)&&event.type==="timeupdate"){return}ui.toggleControls.call(this)},checkLoading:function checkLoading(event){var _this4=this;this.loading=["stalled","waiting"].includes(event.type);clearTimeout(this.timers.loading);this.timers.loading=setTimeout(function(){toggleClass(_this4.elements.container,_this4.config.classNames.loading,_this4.loading);ui.toggleControls.call(_this4)},this.loading?250:0)},toggleControls:function toggleControls(force){var controls$$1=this.elements.controls;if(controls$$1&&this.config.hideControls){var recentTouchSeek=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(force||this.loading||this.paused||controls$$1.pressed||controls$$1.hover||recentTouchSeek))}}};var Listeners=function(){function Listeners(player){_classCallCheck(this,Listeners);this.player=player;this.lastKey=null;this.focusTimer=null;this.lastKeyDown=null;this.handleKey=this.handleKey.bind(this);this.toggleMenu=this.toggleMenu.bind(this);this.setTabFocus=this.setTabFocus.bind(this);this.firstTouch=this.firstTouch.bind(this)}_createClass(Listeners,[{key:"handleKey",value:function handleKey(event){var player=this.player;var elements=player.elements;var code=event.keyCode?event.keyCode:event.which;var pressed=event.type==="keydown";var repeat=pressed&&code===this.lastKey;if(event.altKey||event.ctrlKey||event.metaKey||event.shiftKey){return}if(!is.number(code)){return}var seekByKey=function seekByKey(){player.currentTime=player.duration/10*(code-48)};if(pressed){var focused=document.activeElement;if(is.element(focused)){var editable=player.config.selectors.editable;var seek=elements.inputs.seek;if(focused!==seek&&matches(focused,editable)){return}if(event.which===32&&matches(focused,'button, [role^="menuitem"]')){return}}var preventDefault=[32,37,38,39,40,48,49,50,51,52,53,54,56,57,67,70,73,75,76,77,79];if(preventDefault.includes(code)){event.preventDefault();event.stopPropagation()}switch(code){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(!repeat){seekByKey()}break;case 32:case 75:if(!repeat){player.togglePlay()}break;case 38:player.increaseVolume(.1);break;case 40:player.decreaseVolume(.1);break;case 77:if(!repeat){player.muted=!player.muted}break;case 39:player.forward();break;case 37:player.rewind();break;case 70:player.fullscreen.toggle();break;case 67:if(!repeat){player.toggleCaptions()}break;case 76:player.loop=!player.loop;break;default:break}if(!player.fullscreen.enabled&&player.fullscreen.active&&code===27){player.fullscreen.toggle()}this.lastKey=code}else{this.lastKey=null}}},{key:"toggleMenu",value:function toggleMenu(event){controls.toggleMenu.call(this.player,event)}},{key:"firstTouch",value:function firstTouch(){var player=this.player;var elements=player.elements;player.touch=true;toggleClass(elements.container,player.config.classNames.isTouch,true)}},{key:"setTabFocus",value:function setTabFocus(event){var player=this.player;var elements=player.elements;clearTimeout(this.focusTimer);if(event.type==="keydown"&&event.which!==9){return}if(event.type==="keydown"){this.lastKeyDown=event.timeStamp}var removeCurrent=function removeCurrent(){var className=player.config.classNames.tabFocus;var current=getElements.call(player,".".concat(className));toggleClass(current,className,false)};var wasKeyDown=event.timeStamp-this.lastKeyDown<=20;if(event.type==="focus"&&!wasKeyDown){return}removeCurrent();this.focusTimer=setTimeout(function(){var focused=document.activeElement;if(!elements.container.contains(focused)){return}toggleClass(document.activeElement,player.config.classNames.tabFocus,true)},10)}},{key:"global",value:function global(){var toggle=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var player=this.player;if(player.config.keyboard.global){toggleListener.call(player,window,"keydown keyup",this.handleKey,toggle,false)}toggleListener.call(player,document.body,"click",this.toggleMenu,toggle);once.call(player,document.body,"touchstart",this.firstTouch);toggleListener.call(player,document.body,"keydown focus blur",this.setTabFocus,toggle,false,true)}},{key:"container",value:function container(){var player=this.player;var elements=player.elements;if(!player.config.keyboard.global&&player.config.keyboard.focused){on.call(player,elements.container,"keydown keyup",this.handleKey,false)}on.call(player,elements.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",function(event){var controls$$1=elements.controls;if(controls$$1&&event.type==="enterfullscreen"){controls$$1.pressed=false;controls$$1.hover=false}var show=["touchstart","touchmove","mousemove"].includes(event.type);var delay=0;if(show){ui.toggleControls.call(player,true);delay=player.touch?3e3:2e3}clearTimeout(player.timers.controls);player.timers.controls=setTimeout(function(){return ui.toggleControls.call(player,false)},delay)})}},{key:"media",value:function media(){var player=this.player;var elements=player.elements;on.call(player,player.media,"timeupdate seeking seeked",function(event){return controls.timeUpdate.call(player,event)});on.call(player,player.media,"durationchange loadeddata loadedmetadata",function(event){return controls.durationUpdate.call(player,event)});on.call(player,player.media,"canplay loadeddata",function(){toggleHidden(elements.volume,!player.hasAudio);toggleHidden(elements.buttons.mute,!player.hasAudio)});on.call(player,player.media,"ended",function(){if(player.isHTML5&&player.isVideo&&player.config.resetOnEnd){player.restart()}});on.call(player,player.media,"progress playing seeking seeked",function(event){return controls.updateProgress.call(player,event)});on.call(player,player.media,"volumechange",function(event){return controls.updateVolume.call(player,event)});on.call(player,player.media,"playing play pause ended emptied timeupdate",function(event){return ui.checkPlaying.call(player,event)});on.call(player,player.media,"waiting canplay seeked playing",function(event){return ui.checkLoading.call(player,event)});on.call(player,player.media,"playing",function(){if(!player.ads){return}if(player.ads.enabled&&!player.ads.initialized){player.ads.managerPromise.then(function(){return player.ads.play()}).catch(function(){return player.play()})}});if(player.supported.ui&&player.config.clickToPlay&&!player.isAudio){var wrapper=getElement.call(player,".".concat(player.config.classNames.video));if(!is.element(wrapper)){return}on.call(player,elements.container,"click",function(event){var targets=[elements.container,wrapper];if(!targets.includes(event.target)&&!wrapper.contains(event.target)){return}if(player.touch&&player.config.hideControls){return}if(player.ended){player.restart();player.play()}else{player.togglePlay()}})}if(player.supported.ui&&player.config.disableContextMenu){on.call(player,elements.wrapper,"contextmenu",function(event){event.preventDefault()},false)}on.call(player,player.media,"volumechange",function(){player.storage.set({volume:player.volume,muted:player.muted})});on.call(player,player.media,"ratechange",function(){controls.updateSetting.call(player,"speed");player.storage.set({speed:player.speed})});on.call(player,player.media,"qualitychange",function(event){controls.updateSetting.call(player,"quality",null,event.detail.quality)});on.call(player,player.media,"ready qualitychange",function(){controls.setDownloadLink.call(player)});var proxyEvents=player.config.events.concat(["keyup","keydown"]).join(" ");on.call(player,player.media,proxyEvents,function(event){var _event$detail=event.detail,detail=_event$detail===void 0?{}:_event$detail;if(event.type==="error"){detail=player.media.error}triggerEvent.call(player,elements.container,event.type,true,detail)})}},{key:"proxy",value:function proxy(event,defaultHandler,customHandlerKey){var player=this.player;var customHandler=player.config.listeners[customHandlerKey];var hasCustomHandler=is.function(customHandler);var returned=true;if(hasCustomHandler){returned=customHandler.call(player,event)}if(returned&&is.function(defaultHandler)){defaultHandler.call(player,event)}}},{key:"bind",value:function bind(element,type,defaultHandler,customHandlerKey){var _this=this;var passive=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var player=this.player;var customHandler=player.config.listeners[customHandlerKey];var hasCustomHandler=is.function(customHandler);on.call(player,element,type,function(event){return _this.proxy(event,defaultHandler,customHandlerKey)},passive&&!hasCustomHandler)}},{key:"controls",value:function controls$$1(){var _this2=this;var player=this.player;var elements=player.elements;var inputEvent=browser.isIE?"change":"input";if(elements.buttons.play){Array.from(elements.buttons.play).forEach(function(button){_this2.bind(button,"click",player.togglePlay,"play")})}this.bind(elements.buttons.restart,"click",player.restart,"restart");this.bind(elements.buttons.rewind,"click",player.rewind,"rewind");this.bind(elements.buttons.fastForward,"click",player.forward,"fastForward");this.bind(elements.buttons.mute,"click",function(){player.muted=!player.muted},"mute");this.bind(elements.buttons.captions,"click",function(){return player.toggleCaptions()});this.bind(elements.buttons.download,"click",function(){triggerEvent.call(player,player.media,"download")},"download");this.bind(elements.buttons.fullscreen,"click",function(){player.fullscreen.toggle()},"fullscreen");this.bind(elements.buttons.pip,"click",function(){player.pip="toggle"},"pip");this.bind(elements.buttons.airplay,"click",player.airplay,"airplay");this.bind(elements.buttons.settings,"click",function(event){event.stopPropagation();controls.toggleMenu.call(player,event)});this.bind(elements.buttons.settings,"keyup",function(event){var code=event.which;if(![13,32].includes(code)){return}if(code===13){controls.focusFirstMenuItem.call(player,null,true);return}event.preventDefault();event.stopPropagation();controls.toggleMenu.call(player,event)},null,false);this.bind(elements.settings.menu,"keydown",function(event){if(event.which===27){controls.toggleMenu.call(player,event)}});this.bind(elements.inputs.seek,"mousedown mousemove",function(event){var rect=elements.progress.getBoundingClientRect();var percent=100/rect.width*(event.pageX-rect.left);event.currentTarget.setAttribute("seek-value",percent)});this.bind(elements.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",function(event){var seek=event.currentTarget;var code=event.keyCode?event.keyCode:event.which;var attribute="play-on-seeked";if(is.keyboardEvent(event)&&code!==39&&code!==37){return}player.lastSeekTime=Date.now();var play=seek.hasAttribute(attribute);var done=["mouseup","touchend","keyup"].includes(event.type);if(play&&done){seek.removeAttribute(attribute);player.play()}else if(!done&&player.playing){seek.setAttribute(attribute,"");player.pause()}});if(browser.isIos){var inputs=getElements.call(player,'input[type="range"]');Array.from(inputs).forEach(function(input){return _this2.bind(input,inputEvent,function(event){return repaint(event.target)})})}this.bind(elements.inputs.seek,inputEvent,function(event){var seek=event.currentTarget;var seekTo=seek.getAttribute("seek-value");if(is.empty(seekTo)){seekTo=seek.value}seek.removeAttribute("seek-value");player.currentTime=seekTo/seek.max*player.duration},"seek");this.bind(elements.progress,"mouseenter mouseleave mousemove",function(event){return controls.updateSeekTooltip.call(player,event)});if(browser.isWebkit){Array.from(getElements.call(player,'input[type="range"]')).forEach(function(element){_this2.bind(element,"input",function(event){return controls.updateRangeFill.call(player,event.target)})})}if(player.config.toggleInvert&&!is.element(elements.display.duration)){this.bind(elements.display.currentTime,"click",function(){if(player.currentTime===0){return}player.config.invertTime=!player.config.invertTime;controls.timeUpdate.call(player)})}this.bind(elements.inputs.volume,inputEvent,function(event){player.volume=event.target.value},"volume");this.bind(elements.controls,"mouseenter mouseleave",function(event){elements.controls.hover=!player.touch&&event.type==="mouseenter"});this.bind(elements.controls,"mousedown mouseup touchstart touchend touchcancel",function(event){elements.controls.pressed=["mousedown","touchstart"].includes(event.type)});this.bind(elements.controls,"focusin",function(){var config=player.config,elements=player.elements,timers=player.timers;toggleClass(elements.controls,config.classNames.noTransition,true);ui.toggleControls.call(player,true);setTimeout(function(){toggleClass(elements.controls,config.classNames.noTransition,false)},0);var delay=_this2.touch?3e3:4e3;clearTimeout(timers.controls);timers.controls=setTimeout(function(){return ui.toggleControls.call(player,false)},delay)});this.bind(elements.inputs.volume,"wheel",function(event){var inverted=event.webkitDirectionInvertedFromDevice;var _map=[event.deltaX,-event.deltaY].map(function(value){return inverted?-value:value}),_map2=_slicedToArray(_map,2),x=_map2[0],y=_map2[1];var direction=Math.sign(Math.abs(x)>Math.abs(y)?x:y);player.increaseVolume(direction/50);var volume=player.media.volume;if(direction===1&&volume<1||direction===-1&&volume>0){event.preventDefault()}},"volume",false)}}]);return Listeners}();var commonjsGlobal=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var loadjs_umd=createCommonjsModule(function(module,exports){(function(root,factory){{module.exports=factory()}})(commonjsGlobal,function(){var devnull=function(){},bundleIdCache={},bundleResultCache={},bundleCallbackQueue={};function subscribe(bundleIds,callbackFn){bundleIds=bundleIds.push?bundleIds:[bundleIds];var depsNotFound=[],i=bundleIds.length,numWaiting=i,fn,bundleId,r,q;fn=function(bundleId,pathsNotFound){if(pathsNotFound.length)depsNotFound.push(bundleId);numWaiting--;if(!numWaiting)callbackFn(depsNotFound)};while(i--){bundleId=bundleIds[i];r=bundleResultCache[bundleId];if(r){fn(bundleId,r);continue}q=bundleCallbackQueue[bundleId]=bundleCallbackQueue[bundleId]||[];q.push(fn)}}function publish(bundleId,pathsNotFound){if(!bundleId)return;var q=bundleCallbackQueue[bundleId];bundleResultCache[bundleId]=pathsNotFound;if(!q)return;while(q.length){q[0](bundleId,pathsNotFound);q.splice(0,1)}}function executeCallbacks(args,depsNotFound){if(args.call)args={success:args};if(depsNotFound.length)(args.error||devnull)(depsNotFound);else(args.success||devnull)(args)}function loadFile(path,callbackFn,args,numTries){var doc=document,async=args.async,maxTries=(args.numRetries||0)+1,beforeCallbackFn=args.before||devnull,pathStripped=path.replace(/^(css|img)!/,""),isCss,e;numTries=numTries||0;if(/(^css!|\.css$)/.test(path)){isCss=true;e=doc.createElement("link");e.rel="stylesheet";e.href=pathStripped}else if(/(^img!|\.(png|gif|jpg|svg)$)/.test(path)){e=doc.createElement("img");e.src=pathStripped}else{e=doc.createElement("script");e.src=path;e.async=async===undefined?true:async}e.onload=e.onerror=e.onbeforeload=function(ev){var result=ev.type[0];if(isCss&&"hideFocus"in e){try{if(!e.sheet.cssText.length)result="e"}catch(x){result="e"}}if(result=="e"){numTries+=1;if(numTries<maxTries){return loadFile(path,callbackFn,args,numTries)}}callbackFn(path,result,ev.defaultPrevented)};if(beforeCallbackFn(path,e)!==false)doc.head.appendChild(e)}function loadFiles(paths,callbackFn,args){paths=paths.push?paths:[paths];var numWaiting=paths.length,x=numWaiting,pathsNotFound=[],fn,i;fn=function(path,result,defaultPrevented){if(result=="e")pathsNotFound.push(path);if(result=="b"){if(defaultPrevented)pathsNotFound.push(path);else return}numWaiting--;if(!numWaiting)callbackFn(pathsNotFound)};for(i=0;i<x;i++)loadFile(paths[i],fn,args)}function loadjs(paths,arg1,arg2){var bundleId,args;if(arg1&&arg1.trim)bundleId=arg1;args=(bundleId?arg2:arg1)||{};if(bundleId){if(bundleId in bundleIdCache){throw"LoadJS"}else{bundleIdCache[bundleId]=true}}loadFiles(paths,function(pathsNotFound){executeCallbacks(args,pathsNotFound);publish(bundleId,pathsNotFound)},args)}loadjs.ready=function ready(deps,args){subscribe(deps,function(depsNotFound){executeCallbacks(args,depsNotFound)});return loadjs};loadjs.done=function done(bundleId){publish(bundleId,[])};loadjs.reset=function reset(){bundleIdCache={};bundleResultCache={};bundleCallbackQueue={}};loadjs.isDefined=function isDefined(bundleId){return bundleId in bundleIdCache};return loadjs})});function loadScript(url){return new Promise(function(resolve,reject){loadjs_umd(url,{success:resolve,error:reject})})}function parseId(url){if(is.empty(url)){return null}if(is.number(Number(url))){return url}var regex=/^.*(vimeo.com\/|video\/)(\d+).*/;return url.match(regex)?RegExp.$2:url}function getAspectRatio(width,height){var getRatio=function getRatio(w,h){return h===0?w:getRatio(h,w%h)};var ratio=getRatio(width,height);return"".concat(width/ratio,":").concat(height/ratio)}function assurePlaybackState(play){if(play&&!this.embed.hasPlayed){this.embed.hasPlayed=true}if(this.media.paused===play){this.media.paused=!play;triggerEvent.call(this,this.media,play?"play":"pause")}}var vimeo={setup:function setup(){var _this=this;toggleClass(this.elements.wrapper,this.config.classNames.embed,true);vimeo.setAspectRatio.call(this);if(!is.object(window.Vimeo)){loadScript(this.config.urls.vimeo.sdk).then(function(){vimeo.ready.call(_this)}).catch(function(error){_this.debug.warn("Vimeo API failed to load",error)})}else{vimeo.ready.call(this)}},setAspectRatio:function setAspectRatio(input){var _split$map=(is.string(input)?input:this.config.ratio).split(":").map(Number),_split$map2=_slicedToArray(_split$map,2),x=_split$map2[0],y=_split$map2[1];var padding=100/x*y;vimeo.padding=padding;this.elements.wrapper.style.paddingBottom="".concat(padding,"%");if(this.supported.ui){var height=240;var offset=(height-padding)/(height/50);this.media.style.transform="translateY(-".concat(offset,"%)")}},ready:function ready$$1(){var _this2=this;var player=this;var options={loop:player.config.loop.active,autoplay:player.autoplay,byline:false,portrait:false,title:false,speed:true,transparent:0,gesture:"media",playsinline:!this.config.fullscreen.iosNative};var params=buildUrlParams(options);var source=player.media.getAttribute("src");if(is.empty(source)){source=player.media.getAttribute(player.config.attributes.embed.id)}var id=parseId(source);var iframe=createElement("iframe");var src=format(player.config.urls.vimeo.iframe,id,params);iframe.setAttribute("src",src);iframe.setAttribute("allowfullscreen","");iframe.setAttribute("allowtransparency","");iframe.setAttribute("allow","autoplay");var poster=player.poster;var wrapper=createElement("div",{poster:poster,class:player.config.classNames.embedContainer});wrapper.appendChild(iframe);player.media=replaceElement(wrapper,player.media);fetch(format(player.config.urls.vimeo.api,id),"json").then(function(response){if(is.empty(response)){return}var url=new URL(response[0].thumbnail_large);url.pathname="".concat(url.pathname.split("_")[0],".jpg");ui.setPoster.call(player,url.href).catch(function(){})});player.embed=new window.Vimeo.Player(iframe,{autopause:player.config.autopause,muted:player.muted});player.media.paused=true;player.media.currentTime=0;if(player.supported.ui){player.embed.disableTextTrack()}player.media.play=function(){assurePlaybackState.call(player,true);return player.embed.play()};player.media.pause=function(){assurePlaybackState.call(player,false);return player.embed.pause()};player.media.stop=function(){player.pause();player.currentTime=0};var currentTime=player.media.currentTime;Object.defineProperty(player.media,"currentTime",{get:function get(){return currentTime},set:function set(time){var embed=player.embed,media=player.media,paused=player.paused,volume=player.volume;var restorePause=paused&&!embed.hasPlayed;media.seeking=true;triggerEvent.call(player,media,"seeking");Promise.resolve(restorePause&&embed.setVolume(0)).then(function(){return embed.setCurrentTime(time)}).then(function(){return restorePause&&embed.pause()}).then(function(){return restorePause&&embed.setVolume(volume)}).catch(function(){})}});var speed=player.config.speed.selected;Object.defineProperty(player.media,"playbackRate",{get:function get(){return speed},set:function set(input){player.embed.setPlaybackRate(input).then(function(){speed=input;triggerEvent.call(player,player.media,"ratechange")}).catch(function(error){if(error.name==="Error"){controls.setSpeedMenu.call(player,[])}})}});var volume=player.config.volume;Object.defineProperty(player.media,"volume",{get:function get(){return volume},set:function set(input){player.embed.setVolume(input).then(function(){volume=input;triggerEvent.call(player,player.media,"volumechange")})}});var muted=player.config.muted;Object.defineProperty(player.media,"muted",{get:function get(){return muted},set:function set(input){var toggle=is.boolean(input)?input:false;player.embed.setVolume(toggle?0:player.config.volume).then(function(){muted=toggle;triggerEvent.call(player,player.media,"volumechange")})}});var loop=player.config.loop;Object.defineProperty(player.media,"loop",{get:function get(){return loop},set:function set(input){var toggle=is.boolean(input)?input:player.config.loop.active;player.embed.setLoop(toggle).then(function(){loop=toggle})}});var currentSrc;player.embed.getVideoUrl().then(function(value){currentSrc=value;controls.setDownloadLink.call(player)}).catch(function(error){_this2.debug.warn(error)});Object.defineProperty(player.media,"currentSrc",{get:function get(){return currentSrc}});Object.defineProperty(player.media,"ended",{get:function get(){return player.currentTime===player.duration}});Promise.all([player.embed.getVideoWidth(),player.embed.getVideoHeight()]).then(function(dimensions){vimeo.ratio=getAspectRatio(dimensions[0],dimensions[1]);vimeo.setAspectRatio.call(_this2,vimeo.ratio)});player.embed.setAutopause(player.config.autopause).then(function(state){player.config.autopause=state});player.embed.getVideoTitle().then(function(title){player.config.title=title;ui.setTitle.call(_this2)});player.embed.getCurrentTime().then(function(value){currentTime=value;triggerEvent.call(player,player.media,"timeupdate")});player.embed.getDuration().then(function(value){player.media.duration=value;triggerEvent.call(player,player.media,"durationchange")});player.embed.getTextTracks().then(function(tracks){player.media.textTracks=tracks;captions.setup.call(player)});player.embed.on("cuechange",function(_ref){var _ref$cues=_ref.cues,cues=_ref$cues===void 0?[]:_ref$cues;var strippedCues=cues.map(function(cue){return stripHTML(cue.text)});captions.updateCues.call(player,strippedCues)});player.embed.on("loaded",function(){player.embed.getPaused().then(function(paused){assurePlaybackState.call(player,!paused);if(!paused){triggerEvent.call(player,player.media,"playing")}});if(is.element(player.embed.element)&&player.supported.ui){var frame=player.embed.element;frame.setAttribute("tabindex",-1)}});player.embed.on("play",function(){assurePlaybackState.call(player,true);triggerEvent.call(player,player.media,"playing")});player.embed.on("pause",function(){assurePlaybackState.call(player,false)});player.embed.on("timeupdate",function(data){player.media.seeking=false;currentTime=data.seconds;triggerEvent.call(player,player.media,"timeupdate")});player.embed.on("progress",function(data){player.media.buffered=data.percent;triggerEvent.call(player,player.media,"progress");if(parseInt(data.percent,10)===1){triggerEvent.call(player,player.media,"canplaythrough")}player.embed.getDuration().then(function(value){if(value!==player.media.duration){player.media.duration=value;triggerEvent.call(player,player.media,"durationchange")}})});player.embed.on("seeked",function(){player.media.seeking=false;triggerEvent.call(player,player.media,"seeked")});player.embed.on("ended",function(){player.media.paused=true;triggerEvent.call(player,player.media,"ended")});player.embed.on("error",function(detail){player.media.error=detail;triggerEvent.call(player,player.media,"error")});player.on("enterfullscreen exitfullscreen",function(event){var target=player.fullscreen.target;if(target!==player.elements.container){return}var toggle=event.type==="enterfullscreen";var _vimeo$ratio$split$ma=vimeo.ratio.split(":").map(Number),_vimeo$ratio$split$ma2=_slicedToArray(_vimeo$ratio$split$ma,2),x=_vimeo$ratio$split$ma2[0],y=_vimeo$ratio$split$ma2[1];var dimension=x>y?"width":"height";target.style[dimension]=toggle?"".concat(vimeo.padding,"%"):null});setTimeout(function(){return ui.build.call(player)},0)}};function parseId$1(url){if(is.empty(url)){return null}var regex=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;return url.match(regex)?RegExp.$2:url}function assurePlaybackState$1(play){if(play&&!this.embed.hasPlayed){this.embed.hasPlayed=true}if(this.media.paused===play){this.media.paused=!play;triggerEvent.call(this,this.media,play?"play":"pause")}}var youtube={setup:function setup(){var _this=this;toggleClass(this.elements.wrapper,this.config.classNames.embed,true);youtube.setAspectRatio.call(this);if(is.object(window.YT)&&is.function(window.YT.Player)){youtube.ready.call(this)}else{loadScript(this.config.urls.youtube.sdk).catch(function(error){_this.debug.warn("YouTube API failed to load",error)});window.onYouTubeReadyCallbacks=window.onYouTubeReadyCallbacks||[];window.onYouTubeReadyCallbacks.push(function(){youtube.ready.call(_this)});window.onYouTubeIframeAPIReady=function(){window.onYouTubeReadyCallbacks.forEach(function(callback){callback()})}}},getTitle:function getTitle(videoId){var _this2=this;if(is.function(this.embed.getVideoData)){var _this$embed$getVideoD=this.embed.getVideoData(),title=_this$embed$getVideoD.title;if(is.empty(title)){this.config.title=title;ui.setTitle.call(this);return}}var key=this.config.keys.google;if(is.string(key)&&!is.empty(key)){var url=format(this.config.urls.youtube.api,videoId,key);fetch(url).then(function(result){if(is.object(result)){_this2.config.title=result.items[0].snippet.title;ui.setTitle.call(_this2)}}).catch(function(){})}},setAspectRatio:function setAspectRatio(){var ratio=this.config.ratio.split(":");this.elements.wrapper.style.paddingBottom="".concat(100/ratio[0]*ratio[1],"%")},ready:function ready$$1(){var player=this;var currentId=player.media.getAttribute("id");if(!is.empty(currentId)&&currentId.startsWith("youtube-")){return}var source=player.media.getAttribute("src");if(is.empty(source)){source=player.media.getAttribute(this.config.attributes.embed.id)}var videoId=parseId$1(source);var id=generateId(player.provider);var poster=player.poster;var container=createElement("div",{id:id,poster:poster});player.media=replaceElement(container,player.media);var posterSrc=function posterSrc(format$$1){return"https://img.youtube.com/vi/".concat(videoId,"/").concat(format$$1,"default.jpg")};loadImage(posterSrc("maxres"),121).catch(function(){return loadImage(posterSrc("sd"),121)}).catch(function(){return loadImage(posterSrc("hq"))}).then(function(image){return ui.setPoster.call(player,image.src)}).then(function(posterSrc){if(!posterSrc.includes("maxres")){player.elements.poster.style.backgroundSize="cover"}}).catch(function(){});player.embed=new window.YT.Player(id,{videoId:videoId,playerVars:{autoplay:player.config.autoplay?1:0,hl:player.config.hl,controls:player.supported.ui?0:1,rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,disablekb:1,playsinline:1,widget_referrer:window?window.location.href:null,cc_load_policy:player.captions.active?1:0,cc_lang_pref:player.config.captions.language},events:{onError:function onError(event){if(!player.media.error){var code=event.data;var message={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[code]||"An unknown error occured";player.media.error={code:code,message:message};triggerEvent.call(player,player.media,"error")}},onPlaybackRateChange:function onPlaybackRateChange(event){var instance=event.target;player.media.playbackRate=instance.getPlaybackRate();triggerEvent.call(player,player.media,"ratechange")},onReady:function onReady(event){if(is.function(player.media.play)){return}var instance=event.target;youtube.getTitle.call(player,videoId);player.media.play=function(){assurePlaybackState$1.call(player,true);instance.playVideo()};player.media.pause=function(){assurePlaybackState$1.call(player,false);instance.pauseVideo()};player.media.stop=function(){instance.stopVideo()};player.media.duration=instance.getDuration();player.media.paused=true;player.media.currentTime=0;Object.defineProperty(player.media,"currentTime",{get:function get(){return Number(instance.getCurrentTime())},set:function set(time){if(player.paused&&!player.embed.hasPlayed){player.embed.mute()}player.media.seeking=true;triggerEvent.call(player,player.media,"seeking");instance.seekTo(time)}});Object.defineProperty(player.media,"playbackRate",{get:function get(){return instance.getPlaybackRate()},set:function set(input){instance.setPlaybackRate(input)}});var volume=player.config.volume;Object.defineProperty(player.media,"volume",{get:function get(){return volume},set:function set(input){volume=input;instance.setVolume(volume*100);triggerEvent.call(player,player.media,"volumechange")}});var muted=player.config.muted;Object.defineProperty(player.media,"muted",{get:function get(){return muted},set:function set(input){var toggle=is.boolean(input)?input:muted;muted=toggle;instance[toggle?"mute":"unMute"]();triggerEvent.call(player,player.media,"volumechange")}});Object.defineProperty(player.media,"currentSrc",{get:function get(){return instance.getVideoUrl()}});Object.defineProperty(player.media,"ended",{get:function get(){return player.currentTime===player.duration}});player.options.speed=instance.getAvailablePlaybackRates();if(player.supported.ui){player.media.setAttribute("tabindex",-1)}triggerEvent.call(player,player.media,"timeupdate");triggerEvent.call(player,player.media,"durationchange");clearInterval(player.timers.buffering);player.timers.buffering=setInterval(function(){player.media.buffered=instance.getVideoLoadedFraction();if(player.media.lastBuffered===null||player.media.lastBuffered<player.media.buffered){triggerEvent.call(player,player.media,"progress")}player.media.lastBuffered=player.media.buffered;if(player.media.buffered===1){clearInterval(player.timers.buffering);triggerEvent.call(player,player.media,"canplaythrough")}},200);setTimeout(function(){return ui.build.call(player)},50)},onStateChange:function onStateChange(event){var instance=event.target;clearInterval(player.timers.playing);var seeked=player.media.seeking&&[1,2].includes(event.data);if(seeked){player.media.seeking=false;triggerEvent.call(player,player.media,"seeked")}switch(event.data){case-1:triggerEvent.call(player,player.media,"timeupdate");player.media.buffered=instance.getVideoLoadedFraction();triggerEvent.call(player,player.media,"progress");break;case 0:assurePlaybackState$1.call(player,false);if(player.media.loop){instance.stopVideo();instance.playVideo()}else{triggerEvent.call(player,player.media,"ended")}break;case 1:if(player.media.paused&&!player.embed.hasPlayed){player.media.pause()}else{assurePlaybackState$1.call(player,true);triggerEvent.call(player,player.media,"playing");player.timers.playing=setInterval(function(){triggerEvent.call(player,player.media,"timeupdate")},50);if(player.media.duration!==instance.getDuration()){player.media.duration=instance.getDuration();triggerEvent.call(player,player.media,"durationchange")}}break;case 2:if(!player.muted){player.embed.unMute()}assurePlaybackState$1.call(player,false);break;default:break}triggerEvent.call(player,player.elements.container,"statechange",false,{code:event.data})}}})}};var media={setup:function setup(){if(!this.media){this.debug.warn("No media element found!");return}toggleClass(this.elements.container,this.config.classNames.type.replace("{0}",this.type),true);toggleClass(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),true);if(this.isEmbed){toggleClass(this.elements.container,this.config.classNames.type.replace("{0}","video"),true)}if(this.isVideo){this.elements.wrapper=createElement("div",{class:this.config.classNames.video});wrap(this.media,this.elements.wrapper);this.elements.poster=createElement("div",{class:this.config.classNames.poster});this.elements.wrapper.appendChild(this.elements.poster)}if(this.isHTML5){html5.extend.call(this)}else if(this.isYouTube){youtube.setup.call(this)}else if(this.isVimeo){vimeo.setup.call(this)}}};var Ads=function(){function Ads(player){var _this=this;_classCallCheck(this,Ads);this.player=player;this.publisherId=player.config.ads.publisherId;this.playing=false;this.initialized=false;this.elements={container:null,displayContainer:null};this.manager=null;this.loader=null;this.cuePoints=null;this.events={};this.safetyTimer=null;this.countdownTimer=null;this.managerPromise=new Promise(function(resolve,reject){_this.on("loaded",resolve);_this.on("error",reject)});this.load()}_createClass(Ads,[{key:"load",value:function load(){var _this2=this;if(this.enabled){if(!is.object(window.google)||!is.object(window.google.ima)){loadScript(this.player.config.urls.googleIMA.sdk).then(function(){_this2.ready()}).catch(function(){_this2.trigger("error",new Error("Google IMA SDK failed to load"))})}else{this.ready()}}}},{key:"ready",value:function ready$$1(){var _this3=this;this.startSafetyTimer(12e3,"ready()");this.managerPromise.then(function(){_this3.clearSafetyTimer("onAdsManagerLoaded()")});this.listeners();this.setupIMA()}},{key:"setupIMA",value:function setupIMA(){this.elements.container=createElement("div",{class:this.player.config.classNames.ads});this.player.elements.container.appendChild(this.elements.container);google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);google.ima.settings.setLocale(this.player.config.ads.language);this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container);this.requestAds()}},{key:"requestAds",value:function requestAds(){var _this4=this;var container=this.player.elements.container;try{this.loader=new google.ima.AdsLoader(this.elements.displayContainer);this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(event){return _this4.onAdsManagerLoaded(event)},false);this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(error){return _this4.onAdError(error)},false);var request=new google.ima.AdsRequest;request.adTagUrl=this.tagUrl;request.linearAdSlotWidth=container.offsetWidth;request.linearAdSlotHeight=container.offsetHeight;request.nonLinearAdSlotWidth=container.offsetWidth;request.nonLinearAdSlotHeight=container.offsetHeight;request.forceNonLinearFullSlot=false;request.setAdWillPlayMuted(!this.player.muted);this.loader.requestAds(request)}catch(e){this.onAdError(e)}}},{key:"pollCountdown",value:function pollCountdown(){var _this5=this;var start=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!start){clearInterval(this.countdownTimer);this.elements.container.removeAttribute("data-badge-text");return}var update=function update(){var time=formatTime(Math.max(_this5.manager.getRemainingTime(),0));var label="".concat(i18n.get("advertisement",_this5.player.config)," - ").concat(time);_this5.elements.container.setAttribute("data-badge-text",label)};this.countdownTimer=setInterval(update,100)}},{key:"onAdsManagerLoaded",value:function onAdsManagerLoaded(event){var _this6=this;if(!this.enabled){return}var settings=new google.ima.AdsRenderingSettings;settings.restoreCustomPlaybackStateOnAdBreakComplete=true;settings.enablePreloading=true;this.manager=event.getAdsManager(this.player,settings);this.cuePoints=this.manager.getCuePoints();if(!is.empty(this.cuePoints)){this.cuePoints.forEach(function(cuePoint){if(cuePoint!==0&&cuePoint!==-1&&cuePoint<_this6.player.duration){var seekElement=_this6.player.elements.progress;if(is.element(seekElement)){var cuePercentage=100/_this6.player.duration*cuePoint;var cue=createElement("span",{class:_this6.player.config.classNames.cues});cue.style.left="".concat(cuePercentage.toString(),"%");seekElement.appendChild(cue)}}})}this.manager.setVolume(this.player.volume);this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(error){return _this6.onAdError(error)});Object.keys(google.ima.AdEvent.Type).forEach(function(type){_this6.manager.addEventListener(google.ima.AdEvent.Type[type],function(event){return _this6.onAdEvent(event)})});this.trigger("loaded")}},{key:"onAdEvent",value:function onAdEvent(event){var _this7=this;var container=this.player.elements.container;var ad=event.getAd();var dispatchEvent=function dispatchEvent(type){var event="ads".concat(type.replace(/_/g,"").toLowerCase());triggerEvent.call(_this7.player,_this7.player.media,event)};switch(event.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded");dispatchEvent(event.type);this.pollCountdown(true);if(!ad.isLinear()){ad.width=container.offsetWidth;ad.height=container.offsetHeight}break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:dispatchEvent(event.type);this.loadAds();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:dispatchEvent(event.type);this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:dispatchEvent(event.type);this.pollCountdown();this.resumeContent();break;case google.ima.AdEvent.Type.STARTED:case google.ima.AdEvent.Type.MIDPOINT:case google.ima.AdEvent.Type.COMPLETE:case google.ima.AdEvent.Type.IMPRESSION:case google.ima.AdEvent.Type.CLICK:dispatchEvent(event.type);break;default:break}}},{key:"onAdError",value:function onAdError(event){this.cancel();this.player.debug.warn("Ads error",event)}},{key:"listeners",value:function listeners(){var _this8=this;var container=this.player.elements.container;var time;this.player.on("ended",function(){_this8.loader.contentComplete()});this.player.on("seeking",function(){time=_this8.player.currentTime;return time});this.player.on("seeked",function(){var seekedTime=_this8.player.currentTime;if(is.empty(_this8.cuePoints)){return}_this8.cuePoints.forEach(function(cuePoint,index){if(time<cuePoint&&cuePoint<seekedTime){_this8.manager.discardAdBreak();_this8.cuePoints.splice(index,1)}})});window.addEventListener("resize",function(){if(_this8.manager){_this8.manager.resize(container.offsetWidth,container.offsetHeight,google.ima.ViewMode.NORMAL)}})}},{key:"play",value:function play(){var _this9=this;var container=this.player.elements.container;if(!this.managerPromise){this.resumeContent()}this.managerPromise.then(function(){_this9.elements.displayContainer.initialize();try{if(!_this9.initialized){_this9.manager.init(container.offsetWidth,container.offsetHeight,google.ima.ViewMode.NORMAL);_this9.manager.start()}_this9.initialized=true}catch(adError){_this9.onAdError(adError)}}).catch(function(){})}},{key:"resumeContent",value:function resumeContent(){this.elements.container.style.zIndex="";this.playing=false;if(this.player.currentTime<this.player.duration){this.player.play()}}},{key:"pauseContent",value:function pauseContent(){this.elements.container.style.zIndex=3;this.playing=true;this.player.pause()}},{key:"cancel",value:function cancel(){if(this.initialized){this.resumeContent()}this.trigger("error");this.loadAds()}},{key:"loadAds",value:function loadAds(){var _this10=this;this.managerPromise.then(function(){if(_this10.manager){_this10.manager.destroy()}_this10.managerPromise=new Promise(function(resolve){_this10.on("loaded",resolve);_this10.player.debug.log(_this10.manager)});_this10.requestAds()}).catch(function(){})}},{key:"trigger",value:function trigger(event){var _this11=this;for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var handlers=this.events[event];if(is.array(handlers)){handlers.forEach(function(handler){if(is.function(handler)){handler.apply(_this11,args)}})}}},{key:"on",value:function on$$1(event,callback){if(!is.array(this.events[event])){this.events[event]=[]}this.events[event].push(callback);return this}},{key:"startSafetyTimer",value:function startSafetyTimer(time,from){var _this12=this;this.player.debug.log("Safety timer invoked from: ".concat(from));this.safetyTimer=setTimeout(function(){_this12.cancel();_this12.clearSafetyTimer("startSafetyTimer()")},time)}},{key:"clearSafetyTimer",value:function clearSafetyTimer(from){if(!is.nullOrUndefined(this.safetyTimer)){this.player.debug.log("Safety timer cleared from: ".concat(from));clearTimeout(this.safetyTimer);this.safetyTimer=null}}},{key:"enabled",get:function get(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.ads.enabled&&!is.empty(this.publisherId)}},{key:"tagUrl",get:function get(){var params={AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:this.publisherId};var base="https://go.aniview.com/api/adserver6/vast/";return"".concat(base,"?").concat(buildUrlParams(params))}}]);return Ads}();var source={insertElements:function insertElements(type,attributes){var _this=this;if(is.string(attributes)){insertElement(type,this.media,{src:attributes})}else if(is.array(attributes)){attributes.forEach(function(attribute){insertElement(type,_this.media,attribute)})}},change:function change(input){var _this2=this;if(!getDeep(input,"sources.length")){this.debug.warn("Invalid source format");return}html5.cancelRequests.call(this);this.destroy.call(this,function(){_this2.options.quality=[];removeElement(_this2.media);_this2.media=null;if(is.element(_this2.elements.container)){_this2.elements.container.removeAttribute("class")}var sources=input.sources,type=input.type;var _sources=_slicedToArray(sources,1),_sources$=_sources[0],_sources$$provider=_sources$.provider,provider=_sources$$provider===void 0?providers.html5:_sources$$provider,src=_sources$.src;var tagName=provider==="html5"?type:"div";var attributes=provider==="html5"?{}:{src:src};Object.assign(_this2,{provider:provider,type:type,supported:support.check(type,provider,_this2.config.playsinline),media:createElement(tagName,attributes)});_this2.elements.container.appendChild(_this2.media);if(is.boolean(input.autoplay)){_this2.config.autoplay=input.autoplay}if(_this2.isHTML5){if(_this2.config.crossorigin){_this2.media.setAttribute("crossorigin","")}if(_this2.config.autoplay){_this2.media.setAttribute("autoplay","")}if(!is.empty(input.poster)){_this2.poster=input.poster}if(_this2.config.loop.active){_this2.media.setAttribute("loop","")}if(_this2.config.muted){_this2.media.setAttribute("muted","")}if(_this2.config.playsinline){_this2.media.setAttribute("playsinline","")}}ui.addStyleHook.call(_this2);if(_this2.isHTML5){source.insertElements.call(_this2,"source",sources)}_this2.config.title=input.title;media.setup.call(_this2);if(_this2.isHTML5){if(Object.keys(input).includes("tracks")){source.insertElements.call(_this2,"track",input.tracks)}}if(_this2.isHTML5||_this2.isEmbed&&!_this2.supported.ui){ui.build.call(_this2)}if(_this2.isHTML5){_this2.media.load()}_this2.fullscreen.update()},true)}};var Plyr=function(){function Plyr(target,options){var _this=this;_classCallCheck(this,Plyr);this.timers={};this.ready=false;this.loading=false;this.failed=false;this.touch=support.touch;this.media=target;if(is.string(this.media)){this.media=document.querySelectorAll(this.media)}if(window.jQuery&&this.media instanceof jQuery||is.nodeList(this.media)||is.array(this.media)){this.media=this.media[0]}this.config=extend({},defaults,Plyr.defaults,options||{},function(){try{return JSON.parse(_this.media.getAttribute("data-plyr-config"))}catch(e){return{}}}());this.elements={container:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}};this.captions={active:null,currentTrack:-1,meta:new WeakMap};this.fullscreen={active:false};this.options={speed:[],quality:[]};this.debug=new Console(this.config.debug);this.debug.log("Config",this.config);this.debug.log("Support",support);if(is.nullOrUndefined(this.media)||!is.element(this.media)){this.debug.error("Setup failed: no suitable element passed");return}if(this.media.plyr){this.debug.warn("Target already setup");return}if(!this.config.enabled){this.debug.error("Setup failed: disabled by config");return}if(!support.check().api){this.debug.error("Setup failed: no support");return}var clone=this.media.cloneNode(true);clone.autoplay=false;this.elements.original=clone;var type=this.media.tagName.toLowerCase();var iframe=null;var url=null;switch(type){case"div":iframe=this.media.querySelector("iframe");if(is.element(iframe)){url=parseUrl(iframe.getAttribute("src"));this.provider=getProviderByUrl(url.toString());this.elements.container=this.media;this.media=iframe;this.elements.container.className="";if(url.search.length){var truthy=["1","true"];if(truthy.includes(url.searchParams.get("autoplay"))){this.config.autoplay=true}if(truthy.includes(url.searchParams.get("loop"))){this.config.loop.active=true}if(this.isYouTube){this.config.playsinline=truthy.includes(url.searchParams.get("playsinline"));this.config.hl=url.searchParams.get("hl")}else{this.config.playsinline=true}}}else{this.provider=this.media.getAttribute(this.config.attributes.embed.provider);this.media.removeAttribute(this.config.attributes.embed.provider)}if(is.empty(this.provider)||!Object.keys(providers).includes(this.provider)){this.debug.error("Setup failed: Invalid provider");return}this.type=types.video;break;case"video":case"audio":this.type=type;this.provider=providers.html5;if(this.media.hasAttribute("crossorigin")){this.config.crossorigin=true}if(this.media.hasAttribute("autoplay")){this.config.autoplay=true}if(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline")){this.config.playsinline=true}if(this.media.hasAttribute("muted")){this.config.muted=true}if(this.media.hasAttribute("loop")){this.config.loop.active=true}break;default:this.debug.error("Setup failed: unsupported type");return}this.supported=support.check(this.type,this.provider,this.config.playsinline);if(!this.supported.api){this.debug.error("Setup failed: no support");return}this.eventListeners=[];this.listeners=new Listeners(this);this.storage=new Storage(this);this.media.plyr=this;if(!is.element(this.elements.container)){this.elements.container=createElement("div");wrap(this.media,this.elements.container)}ui.addStyleHook.call(this);media.setup.call(this);if(this.config.debug){on.call(this,this.elements.container,this.config.events.join(" "),function(event){_this.debug.log("event: ".concat(event.type))})}if(this.isHTML5||this.isEmbed&&!this.supported.ui){ui.build.call(this)}this.listeners.container();this.listeners.global();this.fullscreen=new Fullscreen(this);if(this.config.ads.enabled){this.ads=new Ads(this)}if(this.config.autoplay){this.play()}this.lastSeekTime=0}_createClass(Plyr,[{key:"play",value:function play(){if(!is.function(this.media.play)){return null}return this.media.play()}},{key:"pause",value:function pause(){if(!this.playing||!is.function(this.media.pause)){return}this.media.pause()}},{key:"togglePlay",value:function togglePlay(input){var toggle=is.boolean(input)?input:!this.playing;if(toggle){this.play()}else{this.pause()}}},{key:"stop",value:function stop(){if(this.isHTML5){this.pause();this.restart()}else if(is.function(this.media.stop)){this.media.stop()}}},{key:"restart",value:function restart(){this.currentTime=0}},{key:"rewind",value:function rewind(seekTime){this.currentTime=this.currentTime-(is.number(seekTime)?seekTime:this.config.seekTime)}},{key:"forward",value:function forward(seekTime){this.currentTime=this.currentTime+(is.number(seekTime)?seekTime:this.config.seekTime)}},{key:"increaseVolume",value:function increaseVolume(step){var volume=this.media.muted?0:this.volume;this.volume=volume+(is.number(step)?step:0)}},{key:"decreaseVolume",value:function decreaseVolume(step){this.increaseVolume(-step)}},{key:"toggleCaptions",value:function toggleCaptions(input){captions.toggle.call(this,input,false)}},{key:"airplay",value:function airplay(){if(support.airplay){this.media.webkitShowPlaybackTargetPicker()}}},{key:"toggleControls",value:function toggleControls(toggle){if(this.supported.ui&&!this.isAudio){var isHidden=hasClass(this.elements.container,this.config.classNames.hideControls);var force=typeof toggle==="undefined"?undefined:!toggle;var hiding=toggleClass(this.elements.container,this.config.classNames.hideControls,force);if(hiding&&this.config.controls.includes("settings")&&!is.empty(this.config.settings)){controls.toggleMenu.call(this,false)}if(hiding!==isHidden){var eventName=hiding?"controlshidden":"controlsshown";triggerEvent.call(this,this.media,eventName)}return!hiding}return false}},{key:"on",value:function on$$1(event,callback){on.call(this,this.elements.container,event,callback)}},{key:"once",value:function once$$1(event,callback){once.call(this,this.elements.container,event,callback)}},{key:"off",value:function off$$1(event,callback){off(this.elements.container,event,callback)}},{key:"destroy",value:function destroy(callback){var _this2=this;var soft=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!this.ready){return}var done=function done(){document.body.style.overflow="";_this2.embed=null;if(soft){if(Object.keys(_this2.elements).length){removeElement(_this2.elements.buttons.play);removeElement(_this2.elements.captions);removeElement(_this2.elements.controls);removeElement(_this2.elements.wrapper);_this2.elements.buttons.play=null;_this2.elements.captions=null;_this2.elements.controls=null;_this2.elements.wrapper=null}if(is.function(callback)){callback()}}else{unbindListeners.call(_this2);replaceElement(_this2.elements.original,_this2.elements.container);triggerEvent.call(_this2,_this2.elements.original,"destroyed",true);if(is.function(callback)){callback.call(_this2.elements.original)}_this2.ready=false;setTimeout(function(){_this2.elements=null;_this2.media=null},200)}};this.stop();if(this.isHTML5){clearTimeout(this.timers.loading);ui.toggleNativeControls.call(this,true);done()}else if(this.isYouTube){clearInterval(this.timers.buffering);clearInterval(this.timers.playing);if(this.embed!==null&&is.function(this.embed.destroy)){this.embed.destroy()}done()}else if(this.isVimeo){if(this.embed!==null){this.embed.unload().then(done)}setTimeout(done,200)}}},{key:"supports",value:function supports(type){return support.mime.call(this,type)}},{key:"isHTML5",get:function get(){return Boolean(this.provider===providers.html5)}},{key:"isEmbed",get:function get(){return Boolean(this.isYouTube||this.isVimeo)}},{key:"isYouTube",get:function get(){return Boolean(this.provider===providers.youtube)}},{key:"isVimeo",get:function get(){return Boolean(this.provider===providers.vimeo)}},{key:"isVideo",get:function get(){return Boolean(this.type===types.video)}},{key:"isAudio",get:function get(){return Boolean(this.type===types.audio)}},{key:"playing",get:function get(){return Boolean(this.ready&&!this.paused&&!this.ended)}},{key:"paused",get:function get(){return Boolean(this.media.paused)}},{key:"stopped",get:function get(){return Boolean(this.paused&&this.currentTime===0)}},{key:"ended",get:function get(){return Boolean(this.media.ended)}},{key:"currentTime",set:function set(input){if(!this.duration){return}var inputIsValid=is.number(input)&&input>0;this.media.currentTime=inputIsValid?Math.min(input,this.duration):0;this.debug.log("Seeking to ".concat(this.currentTime," seconds"))},get:function get(){return Number(this.media.currentTime)}},{key:"buffered",get:function get(){var buffered=this.media.buffered;if(is.number(buffered)){return buffered}if(buffered&&buffered.length&&this.duration>0){return buffered.end(0)/this.duration}return 0}},{key:"seeking",get:function get(){return Boolean(this.media.seeking)}},{key:"duration",get:function get(){var fauxDuration=parseFloat(this.config.duration);var realDuration=(this.media||{}).duration;var duration=!is.number(realDuration)||realDuration===Infinity?0:realDuration;return fauxDuration||duration}},{key:"volume",set:function set(value){var volume=value;var max=1;var min=0;if(is.string(volume)){volume=Number(volume)}if(!is.number(volume)){volume=this.storage.get("volume")}if(!is.number(volume)){volume=this.config.volume}if(volume>max){volume=max}if(volume<min){volume=min}this.config.volume=volume;this.media.volume=volume;if(!is.empty(value)&&this.muted&&volume>0){this.muted=false}},get:function get(){return Number(this.media.volume)}},{key:"muted",set:function set(mute){var toggle=mute;if(!is.boolean(toggle)){toggle=this.storage.get("muted")}if(!is.boolean(toggle)){toggle=this.config.muted}this.config.muted=toggle;this.media.muted=toggle},get:function get(){return Boolean(this.media.muted)}},{key:"hasAudio",get:function get(){if(!this.isHTML5){return true}if(this.isAudio){return true}return Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)}},{key:"speed",set:function set(input){var speed=null;if(is.number(input)){speed=input}if(!is.number(speed)){speed=this.storage.get("speed")}if(!is.number(speed)){speed=this.config.speed.selected}if(speed<.1){speed=.1}if(speed>2){speed=2}if(!this.config.speed.options.includes(speed)){this.debug.warn("Unsupported speed (".concat(speed,")"));return}this.config.speed.selected=speed;this.media.playbackRate=speed},get:function get(){return Number(this.media.playbackRate)}},{key:"quality",set:function set(input){var config=this.config.quality;var options=this.options.quality;if(!options.length){return}var quality=[!is.empty(input)&&Number(input),this.storage.get("quality"),config.selected,config.default].find(is.number);var updateStorage=true;if(!options.includes(quality)){var value=closest(options,quality);this.debug.warn("Unsupported quality option: ".concat(quality,", using ").concat(value," instead"));quality=value;updateStorage=false}config.selected=quality;this.media.quality=quality;if(updateStorage){this.storage.set({quality:quality})}},get:function get(){return this.media.quality}},{key:"loop",set:function set(input){var toggle=is.boolean(input)?input:this.config.loop.active;this.config.loop.active=toggle;this.media.loop=toggle},get:function get(){return Boolean(this.media.loop)}},{key:"source",set:function set(input){source.change.call(this,input)},get:function get(){return this.media.currentSrc}},{key:"download",get:function get(){var download=this.config.urls.download;return is.url(download)?download:this.source}},{key:"poster",set:function set(input){if(!this.isVideo){this.debug.warn("Poster can only be set for video");return}ui.setPoster.call(this,input,false).catch(function(){})},get:function get(){if(!this.isVideo){return null}return this.media.getAttribute("poster")}},{key:"autoplay",set:function set(input){var toggle=is.boolean(input)?input:this.config.autoplay;this.config.autoplay=toggle},get:function get(){return Boolean(this.config.autoplay)}},{key:"currentTrack",set:function set(input){captions.set.call(this,input,false)},get:function get(){var _this$captions=this.captions,toggled=_this$captions.toggled,currentTrack=_this$captions.currentTrack;return toggled?currentTrack:-1}},{key:"language",set:function set(input){captions.setLanguage.call(this,input,false)},get:function get(){return(captions.getCurrentTrack.call(this)||{}).language}},{key:"pip",set:function set(input){if(!support.pip){return}var toggle=is.boolean(input)?input:!this.pip;if(is.function(this.media.webkitSetPresentationMode)){this.media.webkitSetPresentationMode(toggle?pip.active:pip.inactive)}if(is.function(this.media.requestPictureInPicture)){if(!this.pip&&toggle){this.media.requestPictureInPicture()}else if(this.pip&&!toggle){document.exitPictureInPicture()}}},get:function get(){if(!support.pip){return null}if(!is.empty(this.media.webkitPresentationMode)){return this.media.webkitPresentationMode===pip.active}return this.media===document.pictureInPictureElement}}],[{key:"supported",value:function supported(type,provider,inline){return support.check(type,provider,inline)}},{key:"loadSprite",value:function loadSprite$$1(url,id){return loadSprite(url,id)}},{key:"setup",value:function setup(selector){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var targets=null;if(is.string(selector)){targets=Array.from(document.querySelectorAll(selector))}else if(is.nodeList(selector)){targets=Array.from(selector)}else if(is.array(selector)){targets=selector.filter(is.element)}if(is.empty(targets)){return null}return targets.map(function(t){return new Plyr(t,options)})}}]);return Plyr}();Plyr.defaults=cloneDeep(defaults);return Plyr});